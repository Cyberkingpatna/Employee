<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>पंचायती राज विभाग, शेखपुरा - AI अटेंडेंस सिस्टम</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* ========== RESET & BASE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        :root {
            --primary-blue: #1a237e;
            --secondary-blue: #0d47a1;
            --accent-blue: #2196f3;
            --success-green: #00c853;
            --warning-orange: #ff9800;
            --danger-red: #f44336;
            --light-bg: #f5f7fa;
            --text-dark: #263238;
            --text-light: #ffffff;
        }
        
        body {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: var(--text-dark);
            min-height: 100vh;
        }
        
        /* ========== LOADING SCREEN ========== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-blue);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--accent-blue);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            text-align: center;
            font-size: 1.2rem;
            max-width: 300px;
        }
        
        /* ========== MAIN CONTAINER ========== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ========== HEADER ========== */
        .header {
            background: var(--primary-blue);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .app-logo {
            width: 60px;
            height: 60px;
            background: var(--accent-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }
        
        .app-title h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .app-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* ========== TABS ========== */
        .tabs-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .tabs-header {
            display: flex;
            background: #f0f4ff;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 15px 20px;
            border: none;
            background: transparent;
            color: var(--text-dark);
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn.active {
            background: var(--accent-blue);
            color: white;
        }
        
        .tab-content {
            padding: 20px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        /* ========== CARDS ========== */
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .card-title {
            font-size: 1.2rem;
            color: var(--primary-blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ========== FORMS ========== */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--accent-blue);
            outline: none;
        }
        
        /* ========== BUTTONS ========== */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--secondary-blue);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--success-green);
            color: white;
        }
        
        .btn-block {
            width: 100%;
            justify-content: center;
        }
        
        /* ========== STATS GRID ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin: 10px 0;
        }
        
        /* ========== CAMERA ========== */
        .camera-container {
            width: 100%;
            height: 300px;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 15px;
        }
        
        .camera-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #888;
        }
        
        .camera-placeholder i {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        #videoPreview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }
        
        /* ========== RECORDS ========== */
        .records-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .record-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--accent-blue);
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        /* ========== FOOTER ========== */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--primary-blue);
            margin-top: 30px;
        }
        
        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .tabs-header {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">
            पंचायती राज विभाग, शेखपुरा<br>
            AI अटेंडेंस सिस्टम शुरू हो रहा है...
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="container" id="mainContainer" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="app-logo">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="app-title">
                        <h1>पंचायती राज विभाग, शेखपुरा</h1>
                        <p class="app-subtitle">AI-पावर्ड स्मार्ट अटेंडेंस सिस्टम</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="showHelp()">
                        <i class="fas fa-question-circle"></i> मदद
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-btn active" onclick="switchTab('attendance')">
                    <i class="fas fa-camera"></i> अटेंडेंस दर्ज करें
                </button>
                <button class="tab-btn" onclick="switchTab('records')">
                    <i class="fas fa-history"></i> रिकॉर्ड्स
                </button>
                <button class="tab-btn" onclick="switchTab('analytics')">
                    <i class="fas fa-chart-line"></i> एनालिटिक्स
                </button>
                <button class="tab-btn" onclick="switchTab('settings')">
                    <i class="fas fa-cog"></i> सेटिंग्स
                </button>
            </div>
            
            <div class="tab-content">
                <!-- Attendance Tab -->
                <div class="tab-pane active" id="attendanceTab">
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-user"></i> कर्मचारी जानकारी</h3>
                        
                        <div class="form-group">
                            <label class="form-label">कर्मचारी का नाम *</label>
                            <input type="text" class="form-control" id="employeeName" placeholder="नाम डालें">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">विभाग *</label>
                            <select class="form-control" id="department">
                                <option value="">विभाग चुनें</option>
                                <option value="पंचायत विकास">पंचायत विकास</option>
                                <option value="स्वास्थ्य सेवाएं">स्वास्थ्य सेवाएं</option>
                                <option value="शिक्षा">शिक्षा</option>
                                <option value="प्रशासन">प्रशासन</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">पदनाम</label>
                            <input type="text" class="form-control" id="designation" placeholder="पदनाम डालें">
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-camera"></i> फोटो कैप्चर</h3>
                        
                        <div class="camera-container">
                            <div class="camera-placeholder" id="cameraPlaceholder">
                                <i class="fas fa-camera"></i>
                                <p>कैमरा यहाँ दिखेगा</p>
                            </div>
                            <video id="videoPreview" autoplay playsinline></video>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button class="btn btn-primary" onclick="startCamera()">
                                <i class="fas fa-video"></i> कैमरा शुरू करें
                            </button>
                            <button class="btn btn-success" onclick="capturePhoto()" id="captureBtn" disabled>
                                <i class="fas fa-camera-retro"></i> फोटो लें
                            </button>
                        </div>
                    </div>
                    
                    <!-- Photo Preview -->
                    <div class="card" id="photoPreviewCard" style="display: none;">
                        <h3 class="card-title"><i class="fas fa-check-circle"></i> फोटो प्रिव्यू</h3>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <img id="capturedImage" style="max-width: 100%; border-radius: 8px;">
                        </div>
                        
                        <button class="btn btn-primary btn-block" onclick="submitAttendance()">
                            <i class="fas fa-paper-plane"></i> अटेंडेंस सबमिट करें
                        </button>
                    </div>
                </div>
                
                <!-- Records Tab -->
                <div class="tab-pane" id="recordsTab">
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-clipboard-list"></i> अटेंडेंस रिकॉर्ड्स</h3>
                        
                        <div class="records-container" id="recordsList">
                            <div style="text-align: center; padding: 40px; color: #666;">
                                <i class="fas fa-clipboard" style="font-size: 3rem; margin-bottom: 15px;"></i>
                                <p>कोई रिकॉर्ड नहीं मिला</p>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn btn-primary" onclick="exportToCSV()">
                                <i class="fas fa-download"></i> CSV डाउनलोड
                            </button>
                            <button class="btn btn-success" onclick="clearAllRecords()">
                                <i class="fas fa-trash"></i> सभी रिकॉर्ड हटाएं
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Tab -->
                <div class="tab-pane" id="analyticsTab">
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-chart-pie"></i> आज का सारांश</h3>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <i class="fas fa-calendar-day" style="color: var(--accent-blue); font-size: 1.5rem;"></i>
                                <div class="stat-value" id="todayCount">0</div>
                                <div>आज की अटेंडेंस</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-database" style="color: var(--success-green); font-size: 1.5rem;"></i>
                                <div class="stat-value" id="totalCount">0</div>
                                <div>कुल रिकॉर्ड्स</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-chart-line" style="color: var(--warning-orange); font-size: 1.5rem;"></i>
                                <div class="stat-value" id="monthCount">0</div>
                                <div>इस महीने</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-users" style="color: var(--danger-red); font-size: 1.5rem;"></i>
                                <div class="stat-value" id="deptCount">0</div>
                                <div>विभाग</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-lightbulb"></i> AI विश्लेषण</h3>
                        
                        <div id="aiAnalysis" style="padding: 15px; background: #f8f9ff; border-radius: 8px;">
                            <p>जैसे ही आप अटेंडेंस दर्ज करेंगे, AI स्वतः विश्लेषण दिखाएगा</p>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div class="tab-pane" id="settingsTab">
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-cog"></i> सिस्टम सेटिंग्स</h3>
                        
                        <div class="form-group">
                            <label class="form-label">AI सिस्टम</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <label class="switch">
                                    <input type="checkbox" id="aiToggle" checked>
                                    <span class="slider"></span>
                                </label>
                                <span>AI विश्लेषण चालू रखें</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">डेटा स्वतः सेव</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <label class="switch">
                                    <input type="checkbox" id="autoSaveToggle" checked>
                                    <span class="slider"></span>
                                </label>
                                <span>स्वतः सेव करें</span>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="saveSettings()">
                            <i class="fas fa-save"></i> सेटिंग्स सेव करें
                        </button>
                        
                        <button class="btn btn-success" onclick="exportAllData()" style="margin-top: 10px;">
                            <i class="fas fa-download"></i> सभी डाटा डाउनलोड करें
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <p>पंचायती राज विभाग, शेखपुरा - AI स्मार्ट अटेंडेंस सिस्टम</p>
            <p style="font-size: 0.9rem; margin-top: 5px;">Developed by अमन कुमार © 2024</p>
        </footer>
    </div>
    
    <!-- Simple Switch CSS -->
    <style>
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--accent-blue);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>

    <script>
        // ========== GLOBAL VARIABLES ==========
        let attendanceRecords = [];
        let videoStream = null;
        let capturedPhoto = null;
        
        // ========== INITIALIZATION ==========
        window.onload = function() {
            console.log("System starting...");
            
            // Load data from localStorage
            loadData();
            
            // Simulate loading process
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.opacity = '0';
                document.getElementById('mainContainer').style.display = 'block';
                
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                    showNotification('सिस्टम तैयार है! अटेंडेंस दर्ज करना शुरू करें।', 'success');
                }, 500);
                
                // Update stats
                updateStats();
            }, 1500);
        };
        
        // ========== TAB MANAGEMENT ==========
        function switchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // If switching to records tab, refresh list
            if (tabName === 'records') {
                displayRecords();
            }
            
            // If switching to analytics tab, update stats
            if (tabName === 'analytics') {
                updateStats();
                updateAIAnalysis();
            }
        }
        
        // ========== CAMERA FUNCTIONS ==========
        async function startCamera() {
            try {
                const constraints = {
                    video: {
                        facingMode: 'user',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };
                
                videoStream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.getElementById('videoPreview');
                
                video.srcObject = videoStream;
                video.style.display = 'block';
                document.getElementById('cameraPlaceholder').style.display = 'none';
                document.getElementById('captureBtn').disabled = false;
                
                showNotification('कैमरा शुरू हो गया', 'success');
            } catch (error) {
                console.error('Camera error:', error);
                showNotification('कैमरा शुरू करने में त्रुटि: ' + error.message, 'error');
                
                // Show demo image for testing
                document.getElementById('cameraPlaceholder').innerHTML = `
                    <i class="fas fa-user-circle" style="font-size: 4rem;"></i>
                    <p>कैमरा उपलब्ध नहीं</p>
                    <p style="font-size: 0.8rem; margin-top: 10px;">डेमो मोड में</p>
                `;
            }
        }
        
        function capturePhoto() {
            const video = document.getElementById('videoPreview');
            const canvas = document.createElement('canvas');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Add watermark
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(0, 0, canvas.width, 40);
            
            ctx.font = '16px Arial';
            ctx.fillStyle = 'white';
            ctx.fillText('पंचायती राज विभाग, शेखपुरा | ' + new Date().toLocaleString('hi-IN'), 10, 25);
            
            capturedPhoto = canvas.toDataURL('image/jpeg');
            document.getElementById('capturedImage').src = capturedPhoto;
            document.getElementById('photoPreviewCard').style.display = 'block';
            
            // Scroll to preview
            document.getElementById('photoPreviewCard').scrollIntoView({ behavior: 'smooth' });
            
            showNotification('फोटो कैप्चर हो गई', 'success');
        }
        
        // ========== ATTENDANCE FUNCTIONS ==========
        function submitAttendance() {
            const name = document.getElementById('employeeName').value.trim();
            const department = document.getElementById('department').value;
            const designation = document.getElementById('designation').value.trim();
            
            if (!name) {
                showNotification('कृपया कर्मचारी का नाम डालें', 'error');
                return;
            }
            
            if (!department) {
                showNotification('कृपया विभाग चुनें', 'error');
                return;
            }
            
            const record = {
                id: Date.now(),
                name: name,
                department: department,
                designation: designation || 'N/A',
                photo: capturedPhoto || '',
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString('hi-IN'),
                time: new Date().toLocaleTimeString('hi-IN'),
                location: getDemoLocation()
            };
            
            attendanceRecords.unshift(record); // Add to beginning
            saveData();
            
            // Reset form
            document.getElementById('employeeName').value = '';
            document.getElementById('department').value = '';
            document.getElementById('designation').value = '';
            document.getElementById('photoPreviewCard').style.display = 'none';
            
            // Stop camera
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
            }
            
            document.getElementById('videoPreview').style.display = 'none';
            document.getElementById('cameraPlaceholder').style.display = 'flex';
            document.getElementById('captureBtn').disabled = true;
            
            showNotification(`${name} की अटेंडेंस दर्ज हो गई!`, 'success');
            
            // Update stats
            updateStats();
            updateAIAnalysis();
        }
        
        // ========== RECORDS MANAGEMENT ==========
        function displayRecords() {
            const container = document.getElementById('recordsList');
            
            if (attendanceRecords.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-clipboard" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>कोई रिकॉर्ड नहीं मिला</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            attendanceRecords.forEach(record => {
                const initials = record.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                html += `
                    <div class="record-item">
                        <div class="record-header">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 40px; height: 40px; background: var(--accent-blue); 
                                     border-radius: 50%; display: flex; align-items: center; 
                                     justify-content: center; color: white; font-weight: bold;">
                                    ${initials.substring(0, 2)}
                                </div>
                                <div>
                                    <strong>${record.name}</strong>
                                    <div style="font-size: 0.9rem; color: #666;">${record.department}</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 0.9rem; color: #666;">${record.date}</div>
                                <div style="font-size: 0.8rem; color: #888;">${record.time}</div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.9rem;">
                            <span>पदनाम: ${record.designation}</span>
                            <button class="btn" style="padding: 5px 10px; font-size: 0.8rem;" 
                                    onclick="deleteRecord(${record.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function deleteRecord(id) {
            if (confirm('क्या आप वाकई इस रिकॉर्ड को हटाना चाहते हैं?')) {
                attendanceRecords = attendanceRecords.filter(record => record.id !== id);
                saveData();
                displayRecords();
                updateStats();
                showNotification('रिकॉर्ड हटा दिया गया', 'success');
            }
        }
        
        function clearAllRecords() {
            if (attendanceRecords.length === 0) {
                showNotification('हटाने के लिए कोई रिकॉर्ड नहीं', 'warning');
                return;
            }
            
            if (confirm('क्या आप सभी रिकॉर्ड्स हटाना चाहते हैं? यह एक्शन पूर्ववत नहीं किया जा सकता।')) {
                attendanceRecords = [];
                saveData();
                displayRecords();
                updateStats();
                showNotification('सभी रिकॉर्ड्स हटा दिए गए', 'success');
            }
        }
        
        // ========== EXPORT FUNCTIONS ==========
        function exportToCSV() {
            if (attendanceRecords.length === 0) {
                showNotification('एक्सपोर्ट करने के लिए कोई डाटा नहीं', 'warning');
                return;
            }
            
            const headers = ['तारीख', 'समय', 'नाम', 'विभाग', 'पदनाम'];
            const rows = attendanceRecords.map(record => [
                record.date,
                record.time,
                record.name,
                record.department,
                record.designation
            ]);
            
            let csvContent = headers.join(',') + '\n';
            rows.forEach(row => {
                csvContent += row.map(cell => `"${cell}"`).join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `अटेंडेंस_रिकॉर्ड_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            showNotification('CSV फाइल डाउनलोड हो गई', 'success');
        }
        
        function exportAllData() {
            const data = {
                app: 'पंचायती राज विभाग AI अटेंडेंस',
                records: attendanceRecords,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `अटेंडेंस_डाटा_${Date.now()}.json`;
            a.click();
            
            showNotification('सभी डाटा डाउनलोड हो गया', 'success');
        }
        
        // ========== ANALYTICS FUNCTIONS ==========
        function updateStats() {
            const today = new Date().toLocaleDateString('hi-IN');
            const todayRecords = attendanceRecords.filter(r => r.date === today);
            const thisMonth = new Date().getMonth();
            const monthRecords = attendanceRecords.filter(r => new Date(r.timestamp).getMonth() === thisMonth);
            
            document.getElementById('todayCount').textContent = todayRecords.length;
            document.getElementById('totalCount').textContent = attendanceRecords.length;
            document.getElementById('monthCount').textContent = monthRecords.length;
            
            // Count unique departments
            const departments = [...new Set(attendanceRecords.map(r => r.department))].filter(d => d);
            document.getElementById('deptCount').textContent = departments.length;
        }
        
        function updateAIAnalysis() {
            const container = document.getElementById('aiAnalysis');
            
            if (attendanceRecords.length === 0) {
                container.innerHTML = `
                    <p>जैसे ही आप अटेंडेंस दर्ज करेंगे, AI स्वतः विश्लेषण दिखाएगा</p>
                `;
                return;
            }
            
            const today = new Date().toLocaleDateString('hi-IN');
            const todayRecords = attendanceRecords.filter(r => r.date === today);
            const departments = {};
            
            attendanceRecords.forEach(record => {
                departments[record.department] = (departments[record.department] || 0) + 1;
            });
            
            // Find top department
            let topDept = '';
            let maxCount = 0;
            for (const [dept, count] of Object.entries(departments)) {
                if (count > maxCount) {
                    maxCount = count;
                    topDept = dept;
                }
            }
            
            let analysis = `<p><strong>AI विश्लेषण:</strong></p>`;
            analysis += `<p>• आज की अटेंडेंस: ${todayRecords.length}</p>`;
            analysis += `<p>• सबसे अधिक अटेंडेंस: ${topDept} (${maxCount} बार)</p>`;
            analysis += `<p>• कुल विभाग: ${Object.keys(departments).length}</p>`;
            
            if (todayRecords.length < 3 && todayRecords.length > 0) {
                analysis += `<p style="color: var(--warning-orange); margin-top: 10px;">
                    <i class="fas fa-exclamation-triangle"></i> आज की अटेंडेंस कम है
                </p>`;
            }
            
            container.innerHTML = analysis;
        }
        
        // ========== SETTINGS FUNCTIONS ==========
        function saveSettings() {
            const aiEnabled = document.getElementById('aiToggle').checked;
            const autoSave = document.getElementById('autoSaveToggle').checked;
            
            localStorage.setItem('aiEnabled', aiEnabled);
            localStorage.setItem('autoSave', autoSave);
            
            showNotification('सेटिंग्स सेव हो गईं', 'success');
        }
        
        function loadSettings() {
            const aiEnabled = localStorage.getItem('aiEnabled') !== 'false';
            const autoSave = localStorage.getItem('autoSave') !== 'false';
            
            document.getElementById('aiToggle').checked = aiEnabled;
            document.getElementById('autoSaveToggle').checked = autoSave;
        }
        
        // ========== UTILITY FUNCTIONS ==========
        function getDemoLocation() {
            return {
                latitude: 25.1518,
                longitude: 85.8565,
                address: 'पंचायती राज विभाग, शेखपुरा (डेमो लोकेशन)'
            };
        }
        
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
                max-width: 300px;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
            
            // Add animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }
        
        function showHelp() {
            const helpText = `
                <div style="padding: 20px;">
                    <h3 style="margin-bottom: 15px;">पंचायती राज विभाग AI अटेंडेंस सिस्टम</h3>
                    <p><strong>उपयोग विधि:</strong></p>
                    <ol style="margin-left: 20px; margin-bottom: 15px;">
                        <li>कर्मचारी का नाम और विभाग भरें</li>
                        <li>'कैमरा शुरू करें' बटन दबाएं</li>
                        <li>'फोटो लें' बटन दबाकर फोटो कैप्चर करें</li>
                        <li>'अटेंडेंस सबमिट करें' बटन दबाएं</li>
                    </ol>
                    <p><strong>फीचर्स:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>अटेंडेंस दर्ज करें</li>
                        <li>रिकॉर्ड्स देखें</li>
                        <li>AI विश्लेषण</li>
                        <li>डाटा एक्सपोर्ट</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>विकसित:</strong> अमन कुमार</p>
                </div>
            `;
            
            alert(helpText);
        }
        
        // ========== DATA MANAGEMENT ==========
        function saveData() {
            try {
                localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
                console.log('Data saved successfully');
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('डाटा सेव करने में त्रुटि', 'error');
            }
        }
        
        function loadData() {
            try {
                const saved = localStorage.getItem('attendanceRecords');
                if (saved) {
                    attendanceRecords = JSON.parse(saved);
                    console.log('Data loaded successfully:', attendanceRecords.length, 'records');
                }
                
                loadSettings();
            } catch (error) {
                console.error('Error loading data:', error);
                attendanceRecords = [];
            }
        }
        
        // ========== INITIAL SETUP ==========
        // Make sure all essential elements exist
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing...');
            
            // Add event listeners
            document.getElementById('employeeName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('department').focus();
                }
            });
            
            // Initialize
            loadData();
            updateStats();
            updateAIAnalysis();
        });
    </script>
</body>
</html>