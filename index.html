<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="पंचायती राज विभाग, बिहार सरकार के लिए AI आधारित स्मार्ट अटेंडेंस सिस्टम">
    <title>AI स्मार्ट अटेंडेंस - पंचायती राज विभाग, बिहार सरकार</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+Devanagari:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* ========== CSS RESET WITH WCAG COMPLIANT COLORS ========== */
        :root {
            --primary-dark: #002B5C;    /* WCAG AA compliant */
            --primary: #003D7A;
            --primary-light: #2C5E9E;
            --secondary: #1B5E20;       /* Dark Green - WCAG compliant */
            --secondary-light: #2E8B57;
            --accent: #0D47A1;          /* High contrast blue */
            --accent-light: #1565C0;
            --warning: #E65100;         /* High contrast orange */
            --danger: #C62828;          /* High contrast red */
            --success: #1B5E20;
            --dark: #000000;            /* Pure black for best contrast */
            --light: #FFFFFF;
            --gray-dark: #424242;       /* WCAG compliant gray */
            --gray: #757575;
            --gray-light: #BDBDBD;
            --gray-lighter: #F5F5F5;
            
            /* WCAG AA compliance verified colors */
            --text-on-dark: #FFFFFF;
            --text-on-light: #212121;
            --focus-ring: 3px solid #0D47A1;
            
            --card-bg: #FFFFFF;
            --sidebar-bg: #003366;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
            --radius: 12px;
            --radius-sm: 6px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }
        
        body {
            font-family: 'Inter', 'Noto Sans Devanagari', sans-serif;
            background-color: var(--gray-lighter);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* ========== ACCESSIBILITY ENHANCEMENTS ========== */
        .visually-hidden {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }
        
        .skip-to-content {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent);
            color: white;
            padding: 8px;
            z-index: 9999;
            text-decoration: none;
        }
        
        .skip-to-content:focus {
            top: 0;
        }
        
        *:focus {
            outline: var(--focus-ring);
            outline-offset: 3px;
        }
        
        *:focus:not(:focus-visible) {
            outline: none;
        }
        
        *:focus-visible {
            outline: var(--focus-ring);
            outline-offset: 3px;
        }
        
        /* ========== PROPER HEADING HIERARCHY ========== */
        h1 { font-size: 2.5rem; font-weight: 700; }
        h2 { font-size: 2rem; font-weight: 600; }
        h3 { font-size: 1.5rem; font-weight: 600; }
        h4 { font-size: 1.25rem; font-weight: 600; }
        h5 { font-size: 1rem; font-weight: 600; }
        
        /* ========== IMPROVED COLOR CONTRAST ========== */
        .high-contrast-text {
            color: var(--text-on-light) !important;
        }
        
        .high-contrast-bg {
            background-color: var(--dark) !important;
            color: var(--text-on-dark) !important;
        }
        
        /* ========== BETTER FORM LABELS ========== */
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary);
            font-size: 1rem;
        }
        
        .form-label.required::after {
            content: " *";
            color: var(--danger);
        }
        
        /* ========== IMPROVED TABLES FOR ACCESSIBILITY ========== */
        table {
            border-collapse: collapse;
            width: 100%;
        }
        
        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            padding: 1rem;
            text-align: left;
        }
        
        td {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-light);
        }
        
        tr:focus-within {
            background-color: rgba(13, 71, 161, 0.1);
        }
        
        /* ========== ARIA LIVE REGIONS ========== */
        .aria-live {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .aria-live[aria-live="polite"] {
            position: static;
            width: auto;
            height: auto;
            margin: 0;
            clip: auto;
            overflow: visible;
        }
        
        /* ========== LOADING SCREEN ========== */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ========== ADMIN LOGIN PAGE ========== */
        #loginPage {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            padding: 2rem;
        }
        
        .login-container {
            background: white;
            border-radius: var(--radius);
            padding: 3rem;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow-lg);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .login-logo i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .login-form .form-group {
            margin-bottom: 1.5rem;
        }
        
        /* ========== MAIN APP LAYOUT ========== */
        .app-container {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
        }
        
        /* ========== RESPONSIVE HEADER ========== */
        .app-header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .brand-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .gov-logo {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px;
            border: 2px solid white;
        }
        
        .gov-logo i {
            color: var(--primary);
            font-size: 2rem;
        }
        
        .brand-text {
            color: white;
        }
        
        .brand-text h1 {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
            font-weight: 700;
        }
        
        .brand-text p {
            font-size: 0.875rem;
            opacity: 0.95;
        }
        
        /* ========== ENHANCED MOBILE RESPONSIVENESS ========== */
        @media (max-width: 768px) {
            .app-header {
                padding: 0.75rem 1rem;
                flex-direction: column;
                align-items: flex-start;
            }
            
            .brand-section {
                width: 100%;
                justify-content: space-between;
            }
            
            .header-actions {
                width: 100%;
                display: flex;
                justify-content: flex-end;
                margin-top: 0.5rem;
            }
            
            .gov-logo {
                width: 50px;
                height: 50px;
            }
            
            .gov-logo i {
                font-size: 1.5rem;
            }
            
            .brand-text h1 {
                font-size: 1rem;
            }
        }
        
        /* ========== ENHANCED SIDEBAR FOR MOBILE ========== */
        .sidebar {
            background: var(--sidebar-bg);
            border-radius: var(--radius);
            padding: 1.5rem;
            position: sticky;
            top: 1rem;
            height: fit-content;
            color: white;
            box-shadow: var(--shadow);
        }
        
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }
        
        @media (max-width: 1024px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            .sidebar {
                position: fixed;
                top: 0;
                left: -300px;
                width: 300px;
                height: 100vh;
                z-index: 1000;
                transition: transform 0.3s ease;
                transform: translateX(-100%);
                overflow-y: auto;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 999;
            }
            
            .sidebar-overlay.active {
                display: block;
            }
        }
        
        /* ========== RESPONSIVE TABLES ========== */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 1rem 0;
            border-radius: var(--radius-sm);
            border: 1px solid var(--gray-light);
            position: relative;
        }
        
        .table-responsive table {
            min-width: 800px;
        }
        
        @media (max-width: 768px) {
            .table-responsive {
                margin: 0.5rem -1rem;
                width: calc(100% + 2rem);
            }
            
            .table-responsive table {
                min-width: 600px;
            }
            
            th, td {
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
            }
        }
        
        /* ========== ENHANCED DASHBOARD LAYOUT ========== */
        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 1.5rem;
            padding: 1rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 0.5rem;
            }
            
            .sidebar {
                position: static;
                height: auto;
                margin-bottom: 1rem;
            }
        }
        
        /* ========== ENHANCED CARD DESIGN ========== */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--gray-light);
            margin-bottom: 1.5rem;
        }
        
        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-light);
        }
        
        /* ========== ENHANCED BUTTONS ========== */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: var(--transition);
            text-decoration: none;
            min-height: 44px;
            min-width: 44px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* ========== ENHANCED FORM CONTROLS ========== */
        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
            min-height: 48px;
        }
        
        .form-control:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.1);
        }
        
        /* ========== ENHANCED FEEDBACK MESSAGES ========== */
        .notification-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            max-width: 400px;
            width: 90%;
        }
        
        .notification {
            background: white;
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 0.75rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            border-left: 4px solid var(--accent);
            animation: slideIn 0.3s ease;
        }
        
        .loading-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .loading-indicator i {
            font-size: 2rem;
            color: var(--primary);
            animation: spin 1s linear infinite;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--gray-light);
        }
        
        /* ========== SECURITY BADGE ========== */
        .security-badge {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 99;
        }
    </style>
</head>
<body>
    <!-- Skip to Content Link for Accessibility -->
    <a href="#mainContent" class="skip-to-content">मुख्य सामग्री पर जाएं</a>
    
    <!-- Aria Live Region for Screen Readers -->
    <div class="aria-live" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Loading Screen -->
    <div id="loadingScreen" role="status" aria-label="सिस्टम लोड हो रहा है">
        <div class="loader" aria-hidden="true"></div>
        <div class="loader-text" style="color: white; font-size: 1.2rem; margin-top: 1rem;">
            पंचायती राज विभाग, बिहार सरकार
        </div>
        <div class="loader-subtext" style="color: rgba(255,255,255,0.9); margin-top: 0.5rem;">
            AI स्मार्ट अटेंडेंस सिस्टम शुरू हो रहा है...
        </div>
    </div>
    
    <!-- Admin Login Page -->
    <div id="loginPage">
        <div class="login-container">
            <div class="login-logo">
                <i class="fas fa-landmark" aria-hidden="true"></i>
                <h1 style="color: var(--primary); margin-bottom: 0.5rem;">
                    पंचायती राज विभाग, बिहार
                </h1>
                <p style="color: var(--gray-dark);">AI स्मार्ट अटेंडेंस सिस्टम</p>
            </div>
            
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="username" class="form-label required">
                        <i class="fas fa-user" aria-hidden="true"></i> यूजर आईडी
                    </label>
                    <input type="text" 
                           id="username" 
                           class="form-control" 
                           required
                           aria-required="true"
                           placeholder="अपना यूजर आईडी डालें">
                </div>
                
                <div class="form-group">
                    <label for="password" class="form-label required">
                        <i class="fas fa-lock" aria-hidden="true"></i> पासवर्ड
                    </label>
                    <input type="password" 
                           id="password" 
                           class="form-control" 
                           required
                           aria-required="true"
                           placeholder="अपना पासवर्ड डालें">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-sign-in-alt" aria-hidden="true"></i> लॉगिन करें
                    </button>
                </div>
                
                <div style="text-align: center; margin-top: 1rem; color: var(--gray);">
                    <p><strong> </strong></p>
                    <p></code> </p>
                    <p> <code> </code></p>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Main App Container -->
    <div class="app-container" id="mainApp">
        <!-- Header -->
        <header class="app-header" role="banner">
            <div class="brand-section">
                <button class="mobile-menu-toggle" 
                        id="mobileMenuToggle" 
                        aria-label="मेनू खोलें/बंद करें"
                        aria-expanded="false"
                        aria-controls="sidebar">
                    <i class="fas fa-bars" aria-hidden="true"></i>
                </button>
                
                <div class="logo-container">
                    <div class="gov-logo" aria-hidden="true">
                        <i class="fas fa-landmark" role="img" aria-label="बिहार सरकार का लोगो"></i>
                    </div>
                    <div class="brand-text">
                        <h1>पंचायती राज विभाग, बिहार सरकार</h1>
                        <p>AI स्मार्ट अटेंडेंस सिस्टम</p>
                    </div>
                </div>
            </div>
            
            <div class="header-actions">
                <button class="btn btn-primary" onclick="showHelpModal()" aria-label="मदद">
                    <i class="fas fa-question-circle" aria-hidden="true"></i> मदद
                </button>
                <button class="btn btn-danger" onclick="logout()" aria-label="लॉगआउट">
                    <i class="fas fa-sign-out-alt" aria-hidden="true"></i> लॉगआउट
                </button>
            </div>
        </header>
        
        <!-- Mobile Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" role="presentation"></div>
        
        <!-- Dashboard -->
        <div class="dashboard">
            <!-- Sidebar Navigation -->
            <nav class="sidebar" id="sidebar" role="navigation" aria-label="मुख्य नेविगेशन">
                <div class="user-profile" aria-labelledby="userName">
                    <div class="user-avatar" aria-hidden="true">
                        <i class="fas fa-user-tie" role="img" aria-label="यूजर अवतार"></i>
                    </div>
                    <div class="user-info">
                        <h3 id="userName">शेखपुरा जिला</h3>
                        <p class="user-role" id="userRole">पंचायती राज अधिकारी</p>
                    </div>
                </div>
                
                <ul class="sidebar-nav" role="menubar">
                    <li class="nav-item" role="none">
                        <a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')" 
                           role="menuitem" aria-current="page">
                            <i class="fas fa-tachometer-alt" aria-hidden="true"></i>
                            <span>डैशबोर्ड</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="#attendance" class="nav-link" onclick="showSection('attendance')" role="menuitem">
                            <i class="fas fa-camera" aria-hidden="true"></i>
                            <span>अटेंडेंस दर्ज करें</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="#records" class="nav-link" onclick="showSection('records')" role="menuitem">
                            <i class="fas fa-history" aria-hidden="true"></i>
                            <span>अटेंडेंस रिकॉर्ड</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="#employees" class="nav-link" onclick="showSection('employees')" role="menuitem">
                            <i class="fas fa-users" aria-hidden="true"></i>
                            <span>कर्मचारी प्रबंधन</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="#reports" class="nav-link" onclick="showSection('reports')" role="menuitem">
                            <i class="fas fa-file-alt" aria-hidden="true"></i>
                            <span>रिपोर्ट्स</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="#settings" class="nav-link" onclick="showSection('settings')" role="menuitem">
                            <i class="fas fa-cog" aria-hidden="true"></i>
                            <span>सेटिंग्स</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <!-- Main Content -->
            <main id="mainContent" role="main">
                <!-- Welcome Banner -->
                <section class="welcome-banner card" aria-labelledby="greeting">
                    <h2 id="greeting" class="visually-hidden">नमस्ते, पंचायती राज अधिकारी</h2>
                    <div class="welcome-text">
                        <h3 style="margin-bottom: 0.5rem;">नमस्ते, पंचायती राज अधिकारी</h3>
                        <p style="color: var(--gray-dark);">
                            बिहार सरकार के पंचायती राज विभाग के कर्मचारियों की अटेंडेंस दर्ज करने के लिए 
                            AI सिस्टम में आपका स्वागत है।
                        </p>
                    </div>
                </section>
                
                <!-- Dashboard Stats -->
                <section class="dashboard-stats" aria-labelledby="statsTitle">
                    <h3 id="statsTitle" class="visually-hidden">आज का सारांश</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--accent);">
                                <i class="fas fa-user-check" aria-hidden="true"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">आज उपस्थित</span>
                                <span class="stat-value" id="todayPresent">0</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--warning);">
                                <i class="fas fa-user-times" aria-hidden="true"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">आज अनुपस्थित</span>
                                <span class="stat-value" id="todayAbsent">14</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--success);">
                                <i class="fas fa-users" aria-hidden="true"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">कुल कर्मचारी</span>
                                <span class="stat-value" id="totalEmployees">14</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--primary);">
                                <i class="fas fa-clock" aria-hidden="true"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">औसत समय</span>
                                <span class="stat-value" id="avgTime">N/A</span>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Quick Actions -->
                <section class="quick-actions" aria-labelledby="quickActionsTitle">
                    <h3 id="quickActionsTitle" class="visually-hidden">त्वरित कार्रवाइयाँ</h3>
                    <div class="actions-grid">
                        <button class="action-card" onclick="showSection('attendance')">
                            <i class="fas fa-camera" aria-hidden="true"></i>
                            <span>अटेंडेंस दर्ज करें</span>
                        </button>
                        
                        <button class="action-card" onclick="showTodayRecords()">
                            <i class="fas fa-calendar-day" aria-hidden="true"></i>
                            <span>आज का लॉग देखें</span>
                        </button>
                        
                        <button class="action-card" onclick="exportData()">
                            <i class="fas fa-download" aria-hidden="true"></i>
                            <span>डाटा डाउनलोड करें</span>
                        </button>
                        
                        <button class="action-card" onclick="generateDailyReport()">
                            <i class="fas fa-file-export" aria-hidden="true"></i>
                            <span>रिपोर्ट बनाएं</span>
                        </button>
                    </div>
                </section>
            </main>
        </div>
        
        <!-- Security Badge -->
        <div class="security-badge">
            <i class="fas fa-shield-alt" aria-hidden="true"></i>
            <span>सुरक्षित कनेक्शन</span>
        </div>
    </div>

    <script>
        // ========== ENHANCED APPLICATION STRUCTURE ==========
        const App = {
            config: {
                version: '4.1',
                apiEndpoint: '/api/v1',
                adminCredentials: {
                    username: 'Admin',
                    password: 'Admin'
                },
                sessionTimeout: 30 * 60 * 1000 // 30 minutes
            },
            
            state: {
                isAuthenticated: false,
                currentUser: null,
                attendanceRecords: [],
                employees: [],
                settings: {},
                lastActivity: Date.now()
            },
            
            // ========== SECURITY UTILITIES ==========
            Security: {
                sanitizeInput(input) {
                    if (typeof input !== 'string') return input;
                    
                    const div = document.createElement('div');
                    div.textContent = input;
                    return div.innerHTML;
                },
                
                validateEmail(email) {
                    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    return re.test(email);
                },
                
                validatePhone(phone) {
                    const re = /^[0-9]{10}$/;
                    return re.test(phone);
                },
                
                encryptData(data, key = 'panchayat_secure_key') {
                    try {
                        return btoa(encodeURIComponent(JSON.stringify(data)));
                    } catch (error) {
                        console.error('Encryption error:', error);
                        return null;
                    }
                },
                
                decryptData(encryptedData, key = 'panchayat_secure_key') {
                    try {
                        return JSON.parse(decodeURIComponent(atob(encryptedData)));
                    } catch (error) {
                        console.error('Decryption error:', error);
                        return null;
                    }
                },
                
                preventXSS(html) {
                    const element = document.createElement('div');
                    element.textContent = html;
                    return element.innerHTML;
                }
            },
            
            // ========== UI UTILITIES ==========
            UI: {
                showLoading(message = 'लोड हो रहा है...') {
                    const loadingEl = document.createElement('div');
                    loadingEl.className = 'loading-overlay';
                    loadingEl.innerHTML = `
                        <div class="loading-content">
                            <div class="loader"></div>
                            <p>${this.Security.sanitizeInput(message)}</p>
                        </div>
                    `;
                    document.body.appendChild(loadingEl);
                    return loadingEl;
                },
                
                hideLoading(loadingEl) {
                    if (loadingEl && loadingEl.parentNode) {
                        loadingEl.parentNode.removeChild(loadingEl);
                    }
                },
                
                showNotification(message, type = 'info', duration = 5000) {
                    const container = document.getElementById('notificationContainer') || 
                                     this.createNotificationContainer();
                    
                    const notification = document.createElement('div');
                    notification.className = `notification notification-${type}`;
                    notification.setAttribute('role', 'alert');
                    notification.setAttribute('aria-live', 'polite');
                    
                    const icons = {
                        success: 'check-circle',
                        error: 'exclamation-circle',
                        warning: 'exclamation-triangle',
                        info: 'info-circle'
                    };
                    
                    notification.innerHTML = `
                        <i class="fas fa-${icons[type]}" aria-hidden="true"></i>
                        <div>
                            <strong>${this.Security.sanitizeInput(message)}</strong>
                        </div>
                        <button class="btn btn-icon" onclick="this.parentElement.remove()" 
                                aria-label="नोटिफिकेशन बंद करें">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    container.appendChild(notification);
                    
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.style.opacity = '0';
                            setTimeout(() => {
                                if (notification.parentNode) {
                                    notification.parentNode.removeChild(notification);
                                }
                            }, 300);
                        }
                    }, duration);
                },
                
                createNotificationContainer() {
                    const container = document.createElement('div');
                    container.id = 'notificationContainer';
                    container.className = 'notification-container';
                    document.body.appendChild(container);
                    return container;
                },
                
                updateLiveRegion(message) {
                    const liveRegion = document.querySelector('.aria-live');
                    if (liveRegion) {
                        liveRegion.textContent = message;
                        setTimeout(() => {
                            liveRegion.textContent = '';
                        }, 1000);
                    }
                }
            },
            
            // ========== DATA MANAGEMENT ==========
            Data: {
                async loadFromStorage() {
                    try {
                        const encryptedData = localStorage.getItem('panchayat_data');
                        if (encryptedData) {
                            const data = App.Security.decryptData(encryptedData);
                            if (data) {
                                App.state.attendanceRecords = data.attendanceRecords || [];
                                App.state.employees = data.employees || [];
                                App.state.settings = data.settings || {};
                            }
                        }
                    } catch (error) {
                        console.error('Data load error:', error);
                        App.UI.showNotification('डाटा लोड करने में त्रुटि', 'error');
                    }
                },
                
                async saveToStorage() {
                    try {
                        const data = {
                            attendanceRecords: App.state.attendanceRecords,
                            employees: App.state.employees,
                            settings: App.state.settings,
                            timestamp: new Date().toISOString()
                        };
                        
                        const encryptedData = App.Security.encryptData(data);
                        if (encryptedData) {
                            localStorage.setItem('panchayat_data', encryptedData);
                        }
                    } catch (error) {
                        console.error('Data save error:', error);
                        App.UI.showNotification('डाटा सहेजने में त्रुटि', 'error');
                    }
                },
                
                async exportToCSV(data, filename) {
                    if (!data || data.length === 0) {
                        App.UI.showNotification('एक्सपोर्ट करने के लिए कोई डाटा नहीं', 'warning');
                        return;
                    }
                    
                    try {
                        const headers = Object.keys(data[0]);
                        const csvContent = [
                            headers.join(','),
                            ...data.map(row => 
                                headers.map(header => 
                                    `"${String(row[header] || '').replace(/"/g, '""')}"`
                                ).join(',')
                            )
                        ].join('\n');
                        
                        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                        const link = document.createElement('a');
                        const url = URL.createObjectURL(blob);
                        
                        link.setAttribute('href', url);
                        link.setAttribute('download', `${filename}_${Date.now()}.csv`);
                        link.style.visibility = 'hidden';
                        
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        App.UI.showNotification('CSV फाइल डाउनलोड हो गई', 'success');
                    } catch (error) {
                        console.error('Export error:', error);
                        App.UI.showNotification('एक्सपोर्ट करने में त्रुटि', 'error');
                    }
                }
            },
            
            // ========== AUTHENTICATION ==========
            Auth: {
                async login(username, password) {
                    const loading = App.UI.showLoading('लॉगिन हो रहा है...');
                    
                    try {
                        // Simulate API call delay
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        if (username === App.config.adminCredentials.username && 
                            password === App.config.adminCredentials.password) {
                            
                            App.state.isAuthenticated = true;
                            App.state.currentUser = {
                                username: username,
                                role: 'admin',
                                district: 'शेखपुरा जिला',
                                loginTime: new Date().toISOString()
                            };
                            
                            // Save session
                            sessionStorage.setItem('panchayat_session', 
                                App.Security.encryptData(App.state.currentUser));
                            
                            App.UI.showNotification('सफलतापूर्वक लॉगिन हो गया!', 'success');
                            return true;
                        } else {
                            throw new Error('गलत यूजर आईडी या पासवर्ड');
                        }
                    } catch (error) {
                        App.UI.showNotification(error.message, 'error');
                        return false;
                    } finally {
                        App.UI.hideLoading(loading);
                    }
                },
                
                async logout() {
                    App.state.isAuthenticated = false;
                    App.state.currentUser = null;
                    sessionStorage.removeItem('panchayat_session');
                    location.reload();
                },
                
                async checkSession() {
                    try {
                        const session = sessionStorage.getItem('panchayat_session');
                        if (session) {
                            const user = App.Security.decryptData(session);
                            if (user && Date.now() - new Date(user.loginTime).getTime() < App.config.sessionTimeout) {
                                App.state.isAuthenticated = true;
                                App.state.currentUser = user;
                                return true;
                            }
                        }
                        return false;
                    } catch (error) {
                        return false;
                    }
                },
                
                async requireAuth() {
                    if (!App.state.isAuthenticated) {
                        App.UI.showNotification('कृपया पहले लॉगिन करें', 'warning');
                        return false;
                    }
                    return true;
                }
            },
            
            // ========== ATTENDANCE MANAGEMENT ==========
            Attendance: {
                async markAttendance(employeeId, photoData, location, comment = '') {
                    if (!await App.Auth.requireAuth()) return false;
                    
                    const loading = App.UI.showLoading('अटेंडेंस दर्ज की जा रही है...');
                    
                    try {
                        const employee = App.state.employees.find(emp => emp.id === employeeId);
                        if (!employee) {
                            throw new Error('कर्मचारी नहीं मिला');
                        }
                        
                        // Validate inputs
                        if (!photoData) {
                            throw new Error('कृपया फोटो कैप्चर करें');
                        }
                        
                        const now = new Date();
                        const attendanceRecord = {
                            id: Date.now(),
                            employeeId: employeeId,
                            employeeName: employee.name,
                            department: employee.department,
                            designation: employee.designation,
                            timestamp: now.toISOString(),
                            time: now.toLocaleTimeString('hi-IN'),
                            date: now.toISOString().split('T')[0],
                            status: 'present',
                            photoData: photoData,
                            location: location || 'N/A',
                            ipAddress: await this.getIPAddress(),
                            comment: App.Security.sanitizeInput(comment),
                            markedBy: App.state.currentUser.username
                        };
                        
                        App.state.attendanceRecords.unshift(attendanceRecord);
                        await App.Data.saveToStorage();
                        
                        App.UI.showNotification(`${employee.name} की अटेंडेंस दर्ज हो गई!`, 'success');
                        App.UI.updateLiveRegion(`${employee.name} की अटेंडेंस दर्ज की गई`);
                        
                        return true;
                    } catch (error) {
                        App.UI.showNotification(error.message, 'error');
                        return false;
                    } finally {
                        App.UI.hideLoading(loading);
                    }
                },
                
                async getTodayAttendance() {
                    const today = new Date().toISOString().split('T')[0];
                    return App.state.attendanceRecords.filter(record => record.date === today);
                },
                
                async getEmployeeAttendance(employeeId) {
                    return App.state.attendanceRecords
                        .filter(record => record.employeeId === employeeId)
                        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                }
            },
            
            // ========== EMPLOYEE MANAGEMENT ==========
            Employees: {
                async addEmployee(employeeData) {
                    if (!await App.Auth.requireAuth()) return false;
                    
                    // Validate employee data
                    const errors = [];
                    
                    if (!employeeData.name || employeeData.name.trim().length < 2) {
                        errors.push('कृपया वैध नाम डालें');
                    }
                    
                    if (!employeeData.department) {
                        errors.push('कृपया विभाग चुनें');
                    }
                    
                    if (!employeeData.designation) {
                        errors.push('कृपया पदनाम डालें');
                    }
                    
                    if (employeeData.contact && !App.Security.validatePhone(employeeData.contact)) {
                        errors.push('कृपया वैध संपर्क नंबर डालें (10 अंक)');
                    }
                    
                    if (errors.length > 0) {
                        App.UI.showNotification(errors.join(', '), 'error');
                        return false;
                    }
                    
                    const newEmployee = {
                        id: Date.now(),
                        ...employeeData,
                        createdAt: new Date().toISOString(),
                        createdBy: App.state.currentUser.username,
                        isActive: true
                    };
                    
                    App.state.employees.push(newEmployee);
                    await App.Data.saveToStorage();
                    
                    App.UI.showNotification('कर्मचारी सफलतापूर्वक जोड़ा गया', 'success');
                    return true;
                },
                
                async updateEmployee(employeeId, updates) {
                    if (!await App.Auth.requireAuth()) return false;
                    
                    const index = App.state.employees.findIndex(emp => emp.id === employeeId);
                    if (index === -1) {
                        App.UI.showNotification('कर्मचारी नहीं मिला', 'error');
                        return false;
                    }
                    
                    App.state.employees[index] = {
                        ...App.state.employees[index],
                        ...updates,
                        updatedAt: new Date().toISOString(),
                        updatedBy: App.state.currentUser.username
                    };
                    
                    await App.Data.saveToStorage();
                    App.UI.showNotification('कर्मचारी अपडेट हो गया', 'success');
                    return true;
                },
                
                async deleteEmployee(employeeId) {
                    if (!await App.Auth.requireAuth()) return false;
                    
                    const index = App.state.employees.findIndex(emp => emp.id === employeeId);
                    if (index === -1) {
                        App.UI.showNotification('कर्मचारी नहीं मिला', 'error');
                        return false;
                    }
                    
                    App.state.employees.splice(index, 1);
                    await App.Data.saveToStorage();
                    
                    App.UI.showNotification('कर्मचारी हटा दिया गया', 'success');
                    return true;
                }
            },
            
            // ========== INITIALIZATION ==========
            init: async function() {
                // Hide loading screen after initialization
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        
                        // Check existing session
                        this.Auth.checkSession().then(isAuthenticated => {
                            if (isAuthenticated) {
                                this.showApp();
                            } else {
                                this.showLogin();
                            }
                        });
                    }, 500);
                }, 1500);
                
                // Load data from storage
                await this.Data.loadFromStorage();
                
                // Set up event listeners
                this.setupEventListeners();
                
                // Track user activity for session timeout
                document.addEventListener('click', () => {
                    this.state.lastActivity = Date.now();
                });
                
                // Check session timeout every minute
                setInterval(() => {
                    if (this.state.isAuthenticated && 
                        Date.now() - this.state.lastActivity > this.config.sessionTimeout) {
                        this.Auth.logout();
                    }
                }, 60000);
            },
            
            showLogin: function() {
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            },
            
            showApp: function() {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                this.updateDashboard();
            },
            
            setupEventListeners: function() {
                // Login form
                document.getElementById('loginForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value.trim();
                    
                    if (!username || !password) {
                        this.UI.showNotification('कृपया यूजर आईडी और पासवर्ड डालें', 'error');
                        return;
                    }
                    
                    const success = await this.Auth.login(username, password);
                    if (success) {
                        this.showApp();
                    }
                });
                
                // Mobile menu toggle
                document.getElementById('mobileMenuToggle').addEventListener('click', () => {
                    const sidebar = document.getElementById('sidebar');
                    const overlay = document.getElementById('sidebarOverlay');
                    const expanded = sidebar.classList.toggle('active');
                    
                    document.getElementById('mobileMenuToggle')
                        .setAttribute('aria-expanded', expanded);
                    
                    overlay.classList.toggle('active');
                });
                
                // Close sidebar when clicking overlay
                document.getElementById('sidebarOverlay').addEventListener('click', () => {
                    document.getElementById('sidebar').classList.remove('active');
                    document.getElementById('sidebarOverlay').classList.remove('active');
                    document.getElementById('mobileMenuToggle')
                        .setAttribute('aria-expanded', 'false');
                });
                
                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    // Close modals with Escape
                    if (e.key === 'Escape') {
                        const modals = document.querySelectorAll('.modal.active');
                        if (modals.length > 0) {
                            this.closeModal();
                        } else {
                            // Close mobile menu
                            document.getElementById('sidebar').classList.remove('active');
                            document.getElementById('sidebarOverlay').classList.remove('active');
                        }
                    }
                    
                    // Navigate sidebar with arrow keys
                    if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                        const activeElement = document.activeElement;
                        if (activeElement.closest('.sidebar-nav')) {
                            e.preventDefault();
                            const items = Array.from(document.querySelectorAll('.sidebar-nav a'));
                            const currentIndex = items.indexOf(activeElement);
                            let nextIndex;
                            
                            if (e.key === 'ArrowDown') {
                                nextIndex = (currentIndex + 1) % items.length;
                            } else {
                                nextIndex = (currentIndex - 1 + items.length) % items.length;
                            }
                            
                            items[nextIndex].focus();
                        }
                    }
                });
            },
            
            updateDashboard: function() {
                const todayAttendance = this.state.attendanceRecords.filter(record => {
                    const today = new Date().toISOString().split('T')[0];
                    return record.date === today;
                });
                
                document.getElementById('todayPresent').textContent = 
                    todayAttendance.filter(a => a.status === 'present').length;
                document.getElementById('todayAbsent').textContent = 
                    Math.max(0, this.state.employees.length - todayAttendance.length);
                document.getElementById('totalEmployees').textContent = this.state.employees.length;
                
                // Calculate average time
                if (todayAttendance.length > 0) {
                    const times = todayAttendance.map(a => {
                        const [time, period] = a.time.split(' ');
                        let [hours, minutes] = time.split(':').map(Number);
                        if (period === 'PM' && hours < 12) hours += 12;
                        if (period === 'AM' && hours === 12) hours = 0;
                        return hours * 60 + minutes;
                    });
                    
                    const avg = times.reduce((a, b) => a + b, 0) / times.length;
                    const avgHours = Math.floor(avg / 60);
                    const avgMinutes = Math.floor(avg % 60);
                    document.getElementById('avgTime').textContent = 
                        `${avgHours}:${avgMinutes.toString().padStart(2, '0')}`;
                }
            },
            
            // ========== HELPER FUNCTIONS ==========
            async getIPAddress() {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    return data.ip;
                } catch (error) {
                    return 'उपलब्ध नहीं';
                }
            },
            
            showSection: function(section) {
                // Close mobile menu if open
                document.getElementById('sidebar').classList.remove('active');
                document.getElementById('sidebarOverlay').classList.remove('active');
                
                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                    link.setAttribute('aria-current', 'false');
                });
                
                const activeLink = document.querySelector(`.nav-link[href="#${section}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                    activeLink.setAttribute('aria-current', 'page');
                }
            },
            
            logout: function() {
                if (confirm('क्या आप वाकई लॉगआउट करना चाहते हैं?')) {
                    this.Auth.logout();
                }
            },
            
            exportData: function() {
                if (!this.Auth.requireAuth()) return;
                
                const data = {
                    employees: this.state.employees,
                    attendanceRecords: this.state.attendanceRecords,
                    exportDate: new Date().toISOString(),
                    exportedBy: this.state.currentUser.username
                };
                
                this.Data.exportToCSV(this.state.attendanceRecords, 'attendance_records');
            },
            
            showTodayRecords: function() {
                if (!this.Auth.requireAuth()) return;
                this.showSection('records');
            },
            
            generateDailyReport: function() {
                if (!this.Auth.requireAuth()) return;
                
                const today = new Date().toISOString().split('T')[0];
                const todayRecords = this.state.attendanceRecords.filter(r => r.date === today);
                
                if (todayRecords.length === 0) {
                    this.UI.showNotification('आज का कोई रिकॉर्ड नहीं मिला', 'warning');
                    return;
                }
                
                const reportData = todayRecords.map(record => ({
                    कर्मचारी: record.employeeName,
                    विभाग: record.department,
                    पदनाम: record.designation,
                    समय: record.time,
                    स्थिति: record.status,
                    स्थान: record.location,
                    टिप्पणी: record.comment
                }));
                
                this.Data.exportToCSV(reportData, `daily_report_${today}`);
            }
        };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });
        
        // Global helper functions for HTML onclick attributes
        window.showSection = (section) => App.showSection(section);
        window.logout = () => App.logout();
        window.exportData = () => App.exportData();
        window.showTodayRecords = () => App.showTodayRecords();
        window.generateDailyReport = () => App.generateDailyReport();
        
        window.showHelpModal = () => {
            App.UI.showNotification('मदद पृष्ठ जल्द ही उपलब्ध होगा', 'info');
        };
    </script>
</body>
</html>