<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>पंचायती राज विभाग, शेखपुरा - AI अटेंडेंस सिस्टम</title>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* ========== CSS RESET & BASE STYLES ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }
        
        :root {
            --primary-color: #1a237e;
            --secondary-color: #0d47a1;
            --accent-color: #2196f3;
            --accent-gradient: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            --ai-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-color: #00c853;
            --success-gradient: linear-gradient(135deg, #00c853 0%, #64dd17 100%);
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --danger-gradient: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            --info-color: #0097a7;
            --light-bg: #f5f7fa;
            --dark-bg: #121212;
            --text-primary: #263238;
            --text-secondary: #546e7a;
            --text-light: #ffffff;
            --border-color: #cfd8dc;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 5px 15px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.12);
            --shadow-xl: 0 20px 50px rgba(0, 0, 0, 0.15);
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 20px;
            --border-radius-xl: 30px;
            --transition-fast: 0.2s;
            --transition-normal: 0.3s;
            --transition-slow: 0.5s;
        }
        
        body {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 25%, #90caf9 50%, #64b5f6 75%, #42a5f5 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 16px;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* ========== LOADING OVERLAY ========== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 35, 126, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 1;
            visibility: visible;
            transition: opacity var(--transition-slow), visibility var(--transition-slow);
            backdrop-filter: blur(10px);
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            font-size: 1.2rem;
            font-weight: 500;
            margin-top: 15px;
            text-align: center;
            max-width: 300px;
        }
        
        /* ========== APP CONTAINER ========== */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            min-height: calc(100vh - 100px);
        }
        
        /* ========== HEADER ========== */
        .app-header {
            background: rgba(26, 35, 126, 0.9);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius-lg);
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--accent-gradient);
            animation: headerGlow 3s ease-in-out infinite;
        }
        
        @keyframes headerGlow {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .app-logo {
            width: 70px;
            height: 70px;
            background: var(--accent-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .app-title {
            color: white;
        }
        
        .app-title h1 {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        /* ========== ACTION BUTTONS ========== */
        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .action-btn.active {
            background: var(--accent-gradient);
        }
        
        .action-btn .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            font-size: 0.7rem;
            min-width: 20px;
            height: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
        }
        
        /* ========== MAIN CONTENT GRID ========== */
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        
        @media (min-width: 992px) {
            .main-content {
                grid-template-columns: 2fr 1fr;
            }
        }
        
        /* ========== SIDEBAR ========== */
        .sidebar {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.3);
            height: fit-content;
            position: sticky;
            top: 30px;
        }
        
        .sidebar-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(26, 35, 126, 0.1);
        }
        
        .sidebar-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .sidebar-title {
            font-size: 1.1rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        
        .sidebar-title i {
            color: var(--accent-color);
        }
        
        /* ========== STATS CARDS ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--border-radius-md);
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-color);
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 1.2rem;
        }
        
        .stat-icon.today {
            background: rgba(0, 200, 83, 0.1);
            color: var(--success-color);
        }
        
        .stat-icon.total {
            background: rgba(33, 150, 243, 0.1);
            color: var(--accent-color);
        }
        
        .stat-icon.month {
            background: rgba(0, 151, 167, 0.1);
            color: var(--info-color);
        }
        
        .stat-icon.accuracy {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
        }
        
        /* ========== QUICK ACTIONS ========== */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px 10px;
            background: white;
            border: 2px solid transparent;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            text-align: center;
        }
        
        .quick-action-btn:hover {
            border-color: var(--accent-color);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .quick-action-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            font-size: 1.2rem;
            background: var(--accent-gradient);
            color: white;
        }
        
        .quick-action-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        /* ========== MAIN CONTENT AREA ========== */
        .content-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        /* ========== TABS NAVIGATION ========== */
        .tabs-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .tabs-header {
            display: flex;
            background: rgba(26, 35, 126, 0.05);
            border-bottom: 1px solid rgba(26, 35, 126, 0.1);
            padding: 5px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 18px 20px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
        }
        
        .tab-btn:hover {
            color: var(--primary-color);
        }
        
        .tab-btn.active {
            color: white;
            background: var(--accent-gradient);
            border-radius: var(--border-radius-md);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        
        .tab-badge {
            background: var(--danger-color);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
        }
        
        .tabs-content {
            padding: 0;
        }
        
        .tab-pane {
            display: none;
            animation: fadeIn var(--transition-normal);
            padding: 20px;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ========== CARD COMPONENT ========== */
        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(26, 35, 126, 0.1);
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .card-title i {
            color: var(--accent-color);
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        /* ========== FORM CONTROLS ========== */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }
        
        .input-group {
            position: relative;
        }
        
        .input-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-size: 1.1rem;
            z-index: 1;
        }
        
        .form-control {
            width: 100%;
            padding: 18px 18px 18px 50px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-md);
            font-size: 16px;
            background: white;
            color: var(--text-primary);
            transition: all var(--transition-normal);
            position: relative;
        }
        
        .form-control:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
            outline: none;
        }
        
        .form-control.error {
            border-color: var(--danger-color);
            box-shadow: 0 0 0 3px rgba(244, 67, 54, 0.1);
        }
        
        .form-hint {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .form-hint i {
            color: var(--accent-color);
        }
        
        /* ========== AUTOCOMPLETE ========== */
        .autocomplete-container {
            position: relative;
        }
        
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 0 0 var(--border-radius-md) var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            max-height: 250px;
            overflow-y: auto;
            border: 2px solid var(--accent-color);
            border-top: none;
        }
        
        .autocomplete-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            transition: background var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .autocomplete-item:hover {
            background: rgba(33, 150, 243, 0.1);
        }
        
        .autocomplete-item:last-child {
            border-bottom: none;
        }
        
        .employee-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .employee-info {
            flex: 1;
        }
        
        .employee-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .employee-department {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        /* ========== MAP CONTAINER ========== */
        .map-container {
            width: 100%;
            height: 350px;
            border-radius: var(--border-radius-md);
            overflow: hidden;
            margin-bottom: 20px;
            border: 3px solid white;
            box-shadow: var(--shadow-md);
        }
        
        #map, #liveMap {
            width: 100%;
            height: 100%;
        }
        
        .location-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .location-stat {
            background: rgba(26, 35, 126, 0.05);
            padding: 15px;
            border-radius: var(--border-radius-md);
            border-left: 4px solid var(--accent-color);
        }
        
        .location-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .location-value {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }
        
        .address-display {
            background: rgba(0, 200, 83, 0.1);
            border: 2px solid var(--success-color);
            border-radius: var(--border-radius-md);
            padding: 15px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        /* ========== CAMERA SECTION ========== */
        .camera-wrapper {
            position: relative;
            width: 100%;
            height: 400px;
            border-radius: var(--border-radius-md);
            overflow: hidden;
            margin-bottom: 20px;
            background: #000;
            border: 3px solid white;
            box-shadow: var(--shadow-md);
        }
        
        .camera-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #aaa;
            background: linear-gradient(45deg, #0a0a0a 0%, #1a1a1a 100%);
        }
        
        .camera-placeholder i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        #cameraPreview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
            transform: scaleX(-1);
        }
        
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            background: radial-gradient(circle, transparent 50%, rgba(0, 0, 0, 0.3) 100%);
        }
        
        .camera-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border: 3px solid rgba(33, 150, 243, 0.5);
            border-radius: 50%;
            box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
        }
        
        .camera-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        /* ========== BUTTON STYLES ========== */
        .btn {
            padding: 18px 30px;
            border: none;
            border-radius: var(--border-radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn:active {
            transform: translateY(2px);
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn-lg {
            padding: 20px 40px;
            font-size: 1.1rem;
        }
        
        .btn-sm {
            padding: 12px 24px;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: #0d47a1;
            box-shadow: 0 10px 20px rgba(21, 101, 192, 0.3);
        }
        
        .btn-accent {
            background: var(--accent-gradient);
            color: white;
        }
        
        .btn-accent:hover {
            background: linear-gradient(135deg, #1976d2 0%, #2196f3 100%);
            box-shadow: 0 10px 20px rgba(33, 150, 243, 0.3);
        }
        
        .btn-success {
            background: var(--success-gradient);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #64dd17 0%, #00c853 100%);
            box-shadow: 0 10px 20px rgba(0, 200, 83, 0.3);
        }
        
        .btn-danger {
            background: var(--danger-gradient);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%);
            box-shadow: 0 10px 20px rgba(244, 67, 54, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        
        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-outline-accent {
            background: transparent;
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
        }
        
        .btn-outline-accent:hover {
            background: var(--accent-color);
            color: white;
        }
        
        /* ========== PHOTO PREVIEW ========== */
        .photo-preview {
            display: none;
            margin-top: 30px;
            animation: fadeIn var(--transition-slow);
        }
        
        .photo-container {
            position: relative;
            border-radius: var(--border-radius-md);
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
        }
        
        #capturedPhoto {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            background: #f5f7fa;
        }
        
        .photo-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .photo-metadata {
            background: rgba(26, 35, 126, 0.05);
            border-radius: var(--border-radius-md);
            padding: 25px;
            border-left: 5px solid var(--accent-color);
        }
        
        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .metadata-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .metadata-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }
        
        .metadata-value {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }
        
        .verification-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 200, 83, 0.1);
            color: var(--success-color);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .verification-badge.error {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
        }
        
        /* ========== RECORDS SECTION ========== */
        .records-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .record-card {
            background: white;
            border-radius: var(--border-radius-md);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
            cursor: pointer;
            position: relative;
        }
        
        .record-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            border-color: var(--accent-color);
        }
        
        .record-card.selected {
            border-color: var(--accent-color);
            background: rgba(33, 150, 243, 0.05);
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .record-employee {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .record-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .record-info h4 {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 5px;
        }
        
        .record-department {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .record-time {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .record-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(26, 35, 126, 0.1);
        }
        
        .record-detail {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .record-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .record-value {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .record-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            opacity: 0;
            transition: opacity var(--transition-normal);
        }
        
        .record-card:hover .record-actions {
            opacity: 1;
        }
        
        /* ========== FILTERS BAR ========== */
        .filters-bar {
            background: white;
            border-radius: var(--border-radius-md);
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        /* ========== EMPTY STATE ========== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--border-color);
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        /* ========== TOAST NOTIFICATIONS ========== */
        .toast-container {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 9998;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 400px;
        }
        
        .toast {
            background: white;
            border-radius: var(--border-radius-md);
            padding: 20px;
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(150%);
            transition: transform var(--transition-normal);
            border-left: 5px solid var(--accent-color);
            position: relative;
            overflow: hidden;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast::before {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 3px;
            background: var(--accent-color);
            animation: toastProgress 3s linear forwards;
        }
        
        @keyframes toastProgress {
            from { width: 100%; }
            to { width: 0%; }
        }
        
        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .toast.success .toast-icon {
            background: rgba(0, 200, 83, 0.1);
            color: var(--success-color);
        }
        
        .toast.error .toast-icon {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
        }
        
        .toast.warning .toast-icon {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning-color);
        }
        
        .toast.info .toast-icon {
            background: rgba(0, 151, 167, 0.1);
            color: var(--info-color);
        }
        
        .toast-content {
            flex: 1;
        }
        
        .toast-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-primary);
        }
        
        .toast-message {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }
        
        /* ========== NEW AI FEATURES ========== */
        .ai-badge {
            background: var(--ai-gradient);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .voice-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--danger-gradient);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(244, 67, 54, 0.3);
            transition: all var(--transition-normal);
            position: relative;
            animation: pulse 2s infinite;
        }
        
        .voice-btn.listening {
            animation: listening 1.5s infinite;
        }
        
        @keyframes listening {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 20px rgba(244, 67, 54, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
        }
        
        .voice-command {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }
        
        .offline-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--warning-color);
            color: white;
            padding: 15px;
            text-align: center;
            z-index: 10000;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        
        /* ========== FOOTER ========== */
        .app-footer {
            background: rgba(26, 35, 126, 0.9);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .footer-text {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .developer-name {
            font-weight: 600;
            color: #bbdefb;
        }
        
        /* ========== RESPONSIVE DESIGN ========== */
        @media (max-width: 992px) {
            .app-container {
                padding: 15px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                margin-bottom: 30px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 30px;
            }
            
            .tabs-header {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                min-width: 140px;
            }
            
            .photo-actions {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .card {
                padding: 20px;
            }
            
            .filters-bar {
                flex-direction: column;
            }
            
            .filter-group {
                min-width: 100%;
            }
            
            .camera-controls {
                grid-template-columns: 1fr;
            }
            
            .location-stats {
                grid-template-columns: 1fr;
            }
            
            .metadata-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .app-header {
                padding: 15px;
            }
            
            .app-title h1 {
                font-size: 1.5rem;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        
            .btn {
                padding: 15px 20px;
            }
            
            .form-control {
                padding: 15px 15px 15px 45px;
            }
            
            .tab-btn {
                padding: 15px;
                font-size: 0.9rem;
            }
            
            .toast-container {
                top: 20px;
                right: 20px;
                left: 20px;
            }
            
            .toast {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">
            <span class="ai-badge" style="margin-bottom: 20px;">
                <i class="fas fa-brain"></i> AI सिस्टम शुरू हो रहा है...
            </span>
            <br>
            पंचायती राज विभाग, शेखपुरा<br>अटेंडेंस सिस्टम शुरू हो रहा है...
        </div>
    </div>
    
    <!-- Offline Banner -->
    <div class="offline-banner" id="offlineBanner" style="display: none;">
        <i class="fas fa-wifi-slash"></i> ऑफलाइन मोड - डेटा स्थानीय रूप से सेव हो रहा है
    </div>
    
    <!-- Voice Command Button -->
    <div class="voice-command">
        <button class="voice-btn" id="voiceCommandBtn" title="वॉयस कमांड">
            <i class="fas fa-microphone"></i>
        </button>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Main App Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="app-logo">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="app-title">
                        <h1>पंचायती राज विभाग, शेखपुरा</h1>
                        <p class="app-subtitle">
                            <span class="ai-badge">
                                <i class="fas fa-brain"></i> AI-पावर्ड स्मार्ट अटेंडेंस सिस्टम
                            </span>
                        </p>
                    </div>
                </div>
                
                <div class="header-actions">
                    <button class="action-btn" id="aiAssistantBtn" title="AI असिस्टेंट">
                        <i class="fas fa-robot"></i>
                    </button>
                    <button class="action-btn" id="helpBtn" title="मदद">
                        <i class="fas fa-question-circle"></i>
                    </button>
                    <button class="action-btn" id="downloadDataBtn" title="डाटा डाउनलोड करें">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Content Area -->
            <div class="content-area">
                <!-- Tabs Navigation -->
                <div class="tabs-container">
                    <div class="tabs-header">
                        <button class="tab-btn active" data-tab="attendance">
                            <i class="fas fa-camera"></i>
                            अटेंडेंस दर्ज करें
                        </button>
                        <button class="tab-btn" data-tab="records">
                            <i class="fas fa-history"></i>
                            रिकॉर्ड्स
                        </button>
                        <button class="tab-btn" data-tab="map">
                            <i class="fas fa-map-marked-alt"></i>
                            लाइव मैप
                        </button>
                        <button class="tab-btn" data-tab="analytics">
                            <i class="fas fa-chart-line"></i>
                            AI एनालिटिक्स
                        </button>
                    </div>
                    
                    <div class="tabs-content">
                        <!-- Attendance Tab -->
                        <div class="tab-pane active" id="attendanceTab">
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">
                                        <i class="fas fa-user-check"></i>
                                        कर्मचारी जानकारी
                                    </h2>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">कर्मचारी का नाम *</label>
                                    <div class="autocomplete-container">
                                        <div class="input-group">
                                            <i class="fas fa-user input-icon"></i>
                                            <input type="text" class="form-control" id="employeeName" 
                                                   placeholder="कर्मचारी का नाम डालें" 
                                                   autocomplete="off">
                                        </div>
                                        <div class="autocomplete-dropdown" id="nameAutocomplete"></div>
                                    </div>
                                    <div class="form-hint">
                                        <i class="fas fa-lightbulb"></i>
                                        नाम लिखना शुरू करें या सुझाव चुनें
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">विभाग *</label>
                                    <div class="input-group">
                                        <i class="fas fa-building input-icon"></i>
                                        <select class="form-control" id="department">
                                            <option value="">विभाग चुनें</option>
                                            <option value="पंचायत विकास">पंचायत विकास</option>
                                            <option value="स्वास्थ्य सेवाएं">स्वास्थ्य सेवाएं</option>
                                            <option value="शिक्षा">शिक्षा</option>
                                            <option value="प्रशासन">प्रशासन</option>
                                            <option value="फील्ड ऑपरेशन">फील्ड ऑपरेशन</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">पदनाम</label>
                                    <div class="input-group">
                                        <i class="fas fa-briefcase input-icon"></i>
                                        <input type="text" class="form-control" id="designation" 
                                               placeholder="कर्मचारी का पदनाम">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- GPS Location Card -->
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">
                                        <i class="fas fa-map-marker-alt"></i>
                                        लोकेशन वेरिफिकेशन
                                    </h2>
                                    <div class="card-actions">
                                        <button class="btn btn-sm btn-accent" id="refreshLocationBtn">
                                            <i class="fas fa-sync-alt"></i> रिफ्रेश
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="map-container">
                                    <div id="map"></div>
                                </div>
                                
                                <div class="location-stats">
                                    <div class="location-stat">
                                        <div class="location-label">GPS स्टेटस</div>
                                        <div class="location-value" id="gpsStatus">
                                            <i class="fas fa-circle-notch fa-spin"></i> शुरू हो रहा है...
                                        </div>
                                    </div>
                                    <div class="location-stat">
                                        <div class="location-label">निर्देशांक</div>
                                        <div class="location-value" id="coordinates">-</div>
                                    </div>
                                    <div class="location-stat">
                                        <div class="location-label">एक्यूरेसी</div>
                                        <div class="location-value" id="accuracy">-</div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">स्वतः पता प्राप्त हुआ</label>
                                    <div class="address-display" id="addressDisplay">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span id="addressText">लोकेशन प्राप्त होने के बाद पता यहाँ दिखेगा...</span>
                                    </div>
                                </div>
                                
                                <div class="form-hint" style="margin-top: 15px;">
                                    <i class="fas fa-info-circle"></i>
                                    अटेंडेंस वेरिफिकेशन के लिए लोकेशन स्वतः कैप्चर होगी। GPS चालू रखें।
                                </div>
                            </div>
                            
                            <!-- Camera Card -->
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">
                                        <i class="fas fa-camera"></i>
                                        फोटो कैप्चर
                                    </h2>
                                    <div class="card-actions">
                                        <button class="btn btn-sm btn-outline-accent" id="switchCameraBtn">
                                            <i class="fas fa-sync"></i> कैमरा बदलें
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="camera-wrapper">
                                    <div class="camera-placeholder" id="cameraPlaceholder">
                                        <i class="fas fa-camera"></i>
                                        <p>कैमरा यहाँ दिखेगा</p>
                                        <p style="font-size: 0.9rem; margin-top: 10px;">शुरू करने के लिए 'कैमरा शुरू करें' दबाएं</p>
                                    </div>
                                    <video id="cameraPreview" autoplay playsinline></video>
                                    <div class="camera-overlay"></div>
                                    <div class="camera-frame"></div>
                                </div>
                                
                                <div class="camera-controls">
                                    <button class="btn btn-accent" id="startCameraBtn">
                                        <i class="fas fa-video"></i> कैमरा शुरू करें
                                    </button>
                                    <button class="btn btn-success" id="capturePhotoBtn" disabled>
                                        <i class="fas fa-camera-retro"></i> फोटो लें
                                    </button>
                                </div>
                                
                                <div class="form-hint">
                                    <i class="fas fa-lightbulb"></i>
                                    सुझाव: अच्छी रोशनी में, कैमरे के सामने सीधे खड़े हों, और फोटो लेते समय स्थिर रहें।
                                </div>
                            </div>
                            
                            <!-- Photo Preview Section -->
                            <div class="photo-preview" id="photoPreview">
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title">
                                            <i class="fas fa-check-circle"></i>
                                            फोटो प्रिव्यू
                                        </h2>
                                    </div>
                                    
                                    <div class="photo-container">
                                        <img id="capturedPhoto" alt="कैप्चर की गई अटेंडेंस फोटो">
                                    </div>
                                    
                                    <div class="photo-actions">
                                        <button class="btn btn-outline-accent" id="retakePhotoBtn">
                                            <i class="fas fa-redo"></i> दोबारा फोटो लें
                                        </button>
                                        <button class="btn btn-accent" id="saveToPhoneBtn">
                                            <i class="fas fa-mobile-alt"></i> फोन में सेव करें
                                        </button>
                                        <button class="btn btn-success" id="submitAttendanceBtn">
                                            <i class="fas fa-paper-plane"></i> अटेंडेंस सबमिट करें
                                        </button>
                                    </div>
                                    
                                    <div class="photo-metadata">
                                        <div class="metadata-grid">
                                            <div class="metadata-item">
                                                <span class="metadata-label">
                                                    <i class="fas fa-user"></i> कर्मचारी का नाम
                                                </span>
                                                <span class="metadata-value" id="metaName">-</span>
                                            </div>
                                            <div class="metadata-item">
                                                <span class="metadata-label">
                                                    <i class="fas fa-building"></i> विभाग
                                                </span>
                                                <span class="metadata-value" id="metaDepartment">-</span>
                                            </div>
                                            <div class="metadata-item">
                                                <span class="metadata-label">
                                                    <i class="fas fa-clock"></i> तारीख और समय
                                                </span>
                                                <span class="metadata-value" id="metaDateTime">-</span>
                                            </div>
                                            <div class="metadata-item">
                                                <span class="metadata-label">
                                                    <i class="fas fa-map-marker-alt"></i> पता
                                                </span>
                                                <span class="metadata-value" id="metaLocation">-</span>
                                            </div>
                                            <div class="metadata-item">
                                                <span class="metadata-label">
                                                    <i class="fas fa-shield-alt"></i> वेरिफिकेशन
                                                </span>
                                                <span class="metadata-value">
                                                    <span class="verification-badge" id="metaVerification">
                                                        <i class="fas fa-clock"></i> पेंडिंग
                                                    </span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Records Tab -->
                        <div class="tab-pane" id="recordsTab">
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">
                                        <i class="fas fa-clipboard-list"></i>
                                        अटेंडेंस रिकॉर्ड्स
                                    </h2>
                                    <div class="card-actions">
                                        <button class="btn btn-sm btn-accent" id="downloadAllBtn">
                                            <i class="fas fa-download"></i> सभी डाउनलोड करें
                                        </button>
                                        <button class="btn btn-sm btn-danger" id="clearFilterBtn">
                                            <i class="fas fa-filter"></i> फिल्टर हटाएं
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="filters-bar">
                                    <div class="filter-group">
                                        <label class="form-label">तारीख से</label>
                                        <div class="input-group">
                                            <i class="fas fa-calendar input-icon"></i>
                                            <input type="date" class="form-control" id="dateFrom">
                                        </div>
                                    </div>
                                    
                                    <div class="filter-group">
                                        <label class="form-label">तारीख तक</label>
                                        <div class="input-group">
                                            <i class="fas fa-calendar input-icon"></i>
                                            <input type="date" class="form-control" id="dateTo">
                                        </div>
                                    </div>
                                    
                                    <div class="filter-group">
                                        <label class="form-label">विभाग</label>
                                        <div class="input-group">
                                            <i class="fas fa-building input-icon"></i>
                                            <select class="form-control" id="filterDepartment">
                                                <option value="">सभी विभाग</option>
                                                <option value="पंचायत विकास">पंचायत विकास</option>
                                                <option value="स्वास्थ्य सेवाएं">स्वास्थ्य सेवाएं</option>
                                                <option value="शिक्षा">शिक्षा</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <button class="btn btn-accent" id="applyFilterBtn">
                                        <i class="fas fa-filter"></i> फिल्टर लगाएं
                                    </button>
                                </div>
                                
                                <div class="records-container" id="recordsContainer">
                                    <div class="empty-state">
                                        <i class="fas fa-clipboard"></i>
                                        <h3>कोई रिकॉर्ड नहीं मिला</h3>
                                        <p>अटेंडेंस दर्ज करके रिकॉर्ड्स यहाँ देखें</p>
                                    </div>
                                </div>
                                
                                <div class="card-actions" style="margin-top: 20px;">
                                    <button class="btn btn-outline-accent" id="exportCsvBtn">
                                        <i class="fas fa-file-csv"></i> CSV एक्सपोर्ट करें
                                    </button>
                                    <button class="btn btn-success" id="exportToPhoneBtn">
                                        <i class="fas fa-mobile-alt"></i> फोन में सेव करें
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Map Tab -->
                        <div class="tab-pane" id="mapTab">
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">
                                        <i class="fas fa-globe-asia"></i>
                                        लाइव GPS ट्रैकिंग मैप
                                    </h2>
                                </div>
                                
                                <div class="map-container" style="height: 500px;">
                                    <div id="liveMap"></div>
                                </div>
                                
                                <div class="location-stats" style="margin-top: 20px;">
                                    <div class="location-stat">
                                        <div class="location-label">लैटिट्यूड</div>
                                        <div class="location-value" id="liveLat">-</div>
                                    </div>
                                    <div class="location-stat">
                                        <div class="location-label">लॉन्गिट्यूड</div>
                                        <div class="location-value" id="liveLon">-</div>
                                    </div>
                                    <div class="location-stat">
                                        <div class="location-label">स्पीड</div>
                                        <div class="location-value" id="liveSpeed">-</div>
                                    </div>
                                    <div class="location-stat">
                                        <div class="location-label">सटीकता</div>
                                        <div class="location-value" id="liveAccuracy">-</div>
                                    </div>
                                </div>
                                
                                <button class="btn btn-accent btn-block" id="startLiveTrackingBtn" style="margin-top: 20px;">
                                    <i class="fas fa-play-circle"></i> लाइव ट्रैकिंग शुरू करें
                                </button>
                            </div>
                        </div>
                        
                        <!-- Analytics Tab -->
                        <div class="tab-pane" id="analyticsTab">
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">
                                        <i class="fas fa-chart-line"></i>
                                        AI एनालिटिक्स
                                    </h2>
                                    <span class="ai-badge">
                                        <i class="fas fa-brain"></i> लाइव विश्लेषण
                                    </span>
                                </div>
                                
                                <div class="form-hint" style="margin-bottom: 20px;">
                                    <i class="fas fa-info-circle"></i>
                                    AI सिस्टम स्वतः अटेंडेंस पैटर्न का विश्लेषण करता है और सुझाव देता है
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: var(--border-radius-md);">
                                        <div style="font-size: 2rem; font-weight: 800;">95%</div>
                                        <div>औसत उपस्थिति दर</div>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); color: white; padding: 20px; border-radius: var(--border-radius-md);">
                                        <div style="font-size: 2rem; font-weight: 800;">88%</div>
                                        <div>समय पर उपस्थिति</div>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #00c853 0%, #64dd17 100%); color: white; padding: 20px; border-radius: var(--border-radius-md);">
                                        <div style="font-size: 2rem; font-weight: 800;">12</div>
                                        <div>सबसे अधिक उपस्थिति</div>
                                    </div>
                                </div>
                                
                                <div style="background: rgba(102, 126, 234, 0.1); padding: 20px; border-radius: var(--border-radius-md); border-left: 5px solid #667eea; margin-bottom: 20px;">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                        <i class="fas fa-lightbulb" style="color: #764ba2;"></i>
                                        <strong>AI सुझाव:</strong>
                                    </div>
                                    <p id="aiSuggestionText" style="margin: 0;">
                                        डेटा विश्लेषण के अनुसार, पंचायत विकास विभाग में उपस्थिति दर 98% है जो उत्कृष्ट है। स्वास्थ्य सेवाएं विभाग में 10:30 AM के बाद उपस्थिति बढ़ती है।
                                    </p>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                    <div>
                                        <h3 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                            <i class="fas fa-chart-pie"></i> विभागवार विश्लेषण
                                        </h3>
                                        <div id="departmentAnalysis" style="background: white; padding: 20px; border-radius: var(--border-radius-md);">
                                            <!-- AI Analysis will be displayed here -->
                                            <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                                                <i class="fas fa-chart-bar"></i><br>
                                                डेटा लोड हो रहा है...
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h3 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                            <i class="fas fa-clock"></i> समयवार विश्लेषण
                                        </h3>
                                        <div id="timeAnalysis" style="background: white; padding: 20px; border-radius: var(--border-radius-md);">
                                            <!-- Time analysis will be displayed here -->
                                            <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                                                <i class="fas fa-clock"></i><br>
                                                विश्लेषण हो रहा है...
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Sidebar -->
            <div class="sidebar">
                <!-- Today's Stats -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-chart-pie"></i>
                        आज का सारांश
                    </h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon today">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="stat-value" id="statToday">0</div>
                            <div class="stat-label">आज की अटेंडेंस</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon total">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="stat-value" id="statTotal">0</div>
                            <div class="stat-label">कुल रिकॉर्ड्स</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon month">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="stat-value" id="statMonth">0</div>
                            <div class="stat-label">इस महीने</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon accuracy">
                                <i class="fas fa-bullseye"></i>
                            </div>
                            <div class="stat-value" id="statAccuracy">0m</div>
                            <div class="stat-label">औसत सटीकता</div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-bolt"></i>
                        त्वरित कार्रवाई
                    </h3>
                    <div class="quick-actions-grid">
                        <button class="quick-action-btn" id="quickMarkBtn">
                            <div class="quick-action-icon">
                                <i class="fas fa-camera"></i>
                            </div>
                            <span class="quick-action-label">त्वरित अटेंडेंस</span>
                        </button>
                        <button class="quick-action-btn" id="viewTodayBtn">
                            <div class="quick-action-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <span class="quick-action-label">आज का लॉग</span>
                        </button>
                        <button class="quick-action-btn" id="exportDataBtn">
                            <div class="quick-action-icon">
                                <i class="fas fa-download"></i>
                            </div>
                            <span class="quick-action-label">डाटा डाउनलोड</span>
                        </button>
                        <button class="quick-action-btn" id="savePhoneBtn">
                            <div class="quick-action-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <span class="quick-action-label">फोन में सेव</span>
                        </button>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-history"></i>
                        हाल की गतिविधि
                    </h3>
                    <div class="recent-activity" id="recentActivity">
                        <div class="empty-state" style="padding: 20px 0;">
                            <i class="fas fa-history"></i>
                            <p>कोई हाल की गतिविधि नहीं</p>
                        </div>
                    </div>
                </div>
                
                <!-- System Status -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-server"></i>
                        सिस्टम स्टेटस
                    </h3>
                    <div class="system-status">
                        <div class="status-item" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span class="status-label">GPS</span>
                            <span class="status-value" id="statusGps" style="color: var(--success-color);">
                                <i class="fas fa-circle"></i> सक्रिय
                            </span>
                        </div>
                        <div class="status-item" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span class="status-label">कैमरा</span>
                            <span class="status-value" id="statusCamera" style="color: var(--text-secondary);">
                                <i class="fas fa-circle"></i> तैयार
                            </span>
                        </div>
                        <div class="status-item" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span class="status-label">AI सिस्टम</span>
                            <span class="status-value" id="statusAI" style="color: #667eea;">
                                <i class="fas fa-circle"></i> सक्रिय
                            </span>
                        </div>
                        <div class="status-item" style="display: flex; justify-content: space-between;">
                            <span class="status-label">स्टोरेज</span>
                            <span class="status-value" id="statusStorage" style="color: var(--success-color);">
                                <i class="fas fa-circle"></i> 85%
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                <div class="footer-text">पंचायती राज विभाग, शेखपुरा - AI स्मार्ट अटेंडेंस सिस्टम</div>
                <div class="footer-text">Developed by <span class="developer-name">अमन कुमार</span></div>
                <div class="footer-text" style="font-size: 0.8rem;">© 2024 सर्वाधिकार सुरक्षित</div>
            </div>
        </footer>
    </div>
    
    <!-- AI Assistant Modal -->
    <div class="modal" id="aiAssistantModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
         background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: var(--border-radius-lg); width: 90%; max-width: 500px; padding: 30px;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--ai-gradient); 
                     display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <h3 style="margin: 0;">AI असिस्टेंट</h3>
                    <p style="margin: 5px 0 0; color: var(--text-secondary); font-size: 0.9rem;">
                        पूछें "अटेंडेंस रिपोर्ट दिखाओ" या "नया कर्मचारी जोड़ो"
                    </p>
                </div>
            </div>
            
            <div style="background: #f5f7fa; border-radius: var(--border-radius-md); padding: 20px; margin-bottom: 20px;">
                <div id="aiResponse" style="min-height: 100px;">
                    <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                        <i class="fas fa-microphone"></i><br>
                        बोलना शुरू करने के लिए माइक्रोफोन बटन दबाएं
                    </p>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-accent btn-block" id="startListeningBtn">
                    <i class="fas fa-microphone"></i> बोलें
                </button>
                <button class="btn btn-outline btn-block" id="closeAssistantBtn">
                    बंद करें
                </button>
            </div>
        </div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- JavaScript Code -->
    <script>
        // ============================================
        // पंचायती राज विभाग, शेखपुरा - AI स्मार्ट अटेंडेंस सिस्टम
        // ============================================
        
        'use strict';
        
        // Application Configuration
        const CONFIG = {
            APP_NAME: 'पंचायती राज विभाग, शेखपुरा',
            VERSION: '2.0.0',
            MAX_RECORDS: 1000,
            GPS_ACCURACY_THRESHOLD: 50,
            CAMERA_QUALITY: 0.8,
            AI_ENABLED: true,
            VOICE_ENABLED: true
        };
        
        // Application State
        const APP_STATE = {
            isLoading: true,
            isOnline: navigator.onLine,
            currentLocation: null,
            currentAddress: '',
            attendanceRecords: [],
            capturedPhoto: null,
            activeTab: 'attendance',
            selectedRecords: new Set(),
            isListening: false,
            aiAssistantActive: false,
            map: null,
            liveMap: null,
            stream: null
        };
        
        // DOM Elements
        const DOM = {};
        
        // Initialize DOM references
        function initDOMReferences() {
            // Loading Elements
            DOM.loadingOverlay = document.getElementById('loadingOverlay');
            DOM.loadingText = document.getElementById('loadingText');
            
            // Header Elements
            DOM.helpBtn = document.getElementById('helpBtn');
            DOM.downloadDataBtn = document.getElementById('downloadDataBtn');
            DOM.aiAssistantBtn = document.getElementById('aiAssistantBtn');
            
            // Tab Elements
            DOM.tabBtns = document.querySelectorAll('.tab-btn');
            DOM.tabPanes = document.querySelectorAll('.tab-pane');
            
            // Attendance Form Elements
            DOM.employeeName = document.getElementById('employeeName');
            DOM.department = document.getElementById('department');
            DOM.designation = document.getElementById('designation');
            DOM.nameAutocomplete = document.getElementById('nameAutocomplete');
            
            // GPS Elements
            DOM.gpsStatus = document.getElementById('gpsStatus');
            DOM.coordinates = document.getElementById('coordinates');
            DOM.accuracy = document.getElementById('accuracy');
            DOM.addressDisplay = document.getElementById('addressDisplay');
            DOM.addressText = document.getElementById('addressText');
            DOM.refreshLocationBtn = document.getElementById('refreshLocationBtn');
            DOM.map = document.getElementById('map');
            
            // Camera Elements
            DOM.cameraPlaceholder = document.getElementById('cameraPlaceholder');
            DOM.cameraPreview = document.getElementById('cameraPreview');
            DOM.startCameraBtn = document.getElementById('startCameraBtn');
            DOM.capturePhotoBtn = document.getElementById('capturePhotoBtn');
            DOM.switchCameraBtn = document.getElementById('switchCameraBtn');
            
            // Photo Preview Elements
            DOM.photoPreview = document.getElementById('photoPreview');
            DOM.capturedPhoto = document.getElementById('capturedPhoto');
            DOM.retakePhotoBtn = document.getElementById('retakePhotoBtn');
            DOM.saveToPhoneBtn = document.getElementById('saveToPhoneBtn');
            DOM.submitAttendanceBtn = document.getElementById('submitAttendanceBtn');
            
            // Photo Metadata Elements
            DOM.metaName = document.getElementById('metaName');
            DOM.metaDepartment = document.getElementById('metaDepartment');
            DOM.metaDateTime = document.getElementById('metaDateTime');
            DOM.metaLocation = document.getElementById('metaLocation');
            DOM.metaVerification = document.getElementById('metaVerification');
            
            // Records Elements
            DOM.dateFrom = document.getElementById('dateFrom');
            DOM.dateTo = document.getElementById('dateTo');
            DOM.filterDepartment = document.getElementById('filterDepartment');
            DOM.applyFilterBtn = document.getElementById('applyFilterBtn');
            DOM.clearFilterBtn = document.getElementById('clearFilterBtn');
            DOM.recordsContainer = document.getElementById('recordsContainer');
            DOM.exportCsvBtn = document.getElementById('exportCsvBtn');
            DOM.exportToPhoneBtn = document.getElementById('exportToPhoneBtn');
            DOM.downloadAllBtn = document.getElementById('downloadAllBtn');
            
            // Sidebar Elements
            DOM.statToday = document.getElementById('statToday');
            DOM.statTotal = document.getElementById('statTotal');
            DOM.statMonth = document.getElementById('statMonth');
            DOM.statAccuracy = document.getElementById('statAccuracy');
            DOM.quickMarkBtn = document.getElementById('quickMarkBtn');
            DOM.viewTodayBtn = document.getElementById('viewTodayBtn');
            DOM.exportDataBtn = document.getElementById('exportDataBtn');
            DOM.savePhoneBtn = document.getElementById('savePhoneBtn');
            DOM.recentActivity = document.getElementById('recentActivity');
            DOM.statusGps = document.getElementById('statusGps');
            DOM.statusCamera = document.getElementById('statusCamera');
            DOM.statusAI = document.getElementById('statusAI');
            DOM.statusStorage = document.getElementById('statusStorage');
            
            // Map Elements
            DOM.liveMap = document.getElementById('liveMap');
            DOM.liveLat = document.getElementById('liveLat');
            DOM.liveLon = document.getElementById('liveLon');
            DOM.liveSpeed = document.getElementById('liveSpeed');
            DOM.liveAccuracy = document.getElementById('liveAccuracy');
            DOM.startLiveTrackingBtn = document.getElementById('startLiveTrackingBtn');
            
            // AI Elements
            DOM.aiSuggestionText = document.getElementById('aiSuggestionText');
            DOM.departmentAnalysis = document.getElementById('departmentAnalysis');
            DOM.timeAnalysis = document.getElementById('timeAnalysis');
            
            // Voice Command Elements
            DOM.voiceCommandBtn = document.getElementById('voiceCommandBtn');
            DOM.offlineBanner = document.getElementById('offlineBanner');
            
            // AI Assistant Elements
            DOM.aiAssistantModal = document.getElementById('aiAssistantModal');
            DOM.aiResponse = document.getElementById('aiResponse');
            DOM.startListeningBtn = document.getElementById('startListeningBtn');
            DOM.closeAssistantBtn = document.getElementById('closeAssistantBtn');
            
            // Toast Container
            DOM.toastContainer = document.getElementById('toastContainer');
        }
        
        // Utility Functions
        const Utils = {
            formatDate(date, format = 'full') {
                const d = new Date(date);
                if (format === 'date') {
                    return d.toLocaleDateString('hi-IN');
                } else if (format === 'time') {
                    return d.toLocaleTimeString('hi-IN');
                } else {
                    return d.toLocaleString('hi-IN');
                }
            },
            
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            },
            
            async getAddressFromCoordinates(lat, lon) {
                try {
                    // For demo purposes, use a dummy address
                    // In real implementation, use actual API
                    const addresses = [
                        "पंचायती राज विभाग, शेखपुरा, बिहार",
                        "ग्राम पंचायत कार्यालय, शेखपुरा",
                        "ब्लॉक कार्यालय, शेखपुरा",
                        "जिला परिषद कार्यालय, शेखपुरा"
                    ];
                    
                    const randomAddress = addresses[Math.floor(Math.random() * addresses.length)];
                    
                    // Simulate API delay
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    return randomAddress;
                } catch (error) {
                    console.error('Address lookup error:', error);
                    return 'पंचायती राज विभाग, शेखपुरा';
                }
            },
            
            saveToDevice(filename, content, type = 'text/plain') {
                try {
                    const blob = new Blob([content], { type: type });
                    const url = URL.createObjectURL(blob);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename;
                    
                    document.body.appendChild(link);
                    link.click();
                    
                    setTimeout(() => {
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    }, 100);
                    
                    return true;
                } catch (error) {
                    console.error('Save to device error:', error);
                    return false;
                }
            },
            
            // New AI Analysis Functions
            generateAIAnalysis(records) {
                if (!CONFIG.AI_ENABLED) return null;
                
                const analysis = {
                    totalRecords: records.length,
                    departments: {},
                    timeSlots: {
                        morning: 0,
                        afternoon: 0,
                        evening: 0
                    },
                    suggestions: []
                };
                
                // Analyze by department
                records.forEach(record => {
                    const dept = record.department || 'अज्ञात';
                    analysis.departments[dept] = (analysis.departments[dept] || 0) + 1;
                    
                    // Analyze by time
                    const hour = new Date(record.timestamp).getHours();
                    if (hour < 12) analysis.timeSlots.morning++;
                    else if (hour < 17) analysis.timeSlots.afternoon++;
                    else analysis.timeSlots.evening++;
                });
                
                // Generate suggestions
                const today = new Date().toLocaleDateString('hi-IN');
                const todayRecords = records.filter(r => r.date === today);
                
                if (todayRecords.length < 5 && todayRecords.length > 0) {
                    analysis.suggestions.push('आज की अटेंडेंस कम है, कर्मचारियों को याद दिलाएं');
                }
                
                // Find most active department
                let maxDept = '';
                let maxCount = 0;
                for (const [dept, count] of Object.entries(analysis.departments)) {
                    if (count > maxCount) {
                        maxCount = count;
                        maxDept = dept;
                    }
                }
                
                if (maxDept) {
                    analysis.suggestions.push(`${maxDept} विभाग में सबसे अधिक अटेंडेंस है (${maxCount} रिकॉर्ड)`);
                }
                
                return analysis;
            },
            
            updateAIDisplay(analysis) {
                if (!analysis || analysis.totalRecords === 0) {
                    DOM.aiSuggestionText.textContent = 'अभी तक कोई डेटा नहीं है। पहली अटेंडेंस दर्ज करें।';
                    
                    DOM.departmentAnalysis.innerHTML = `
                        <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            <i class="fas fa-chart-bar"></i><br>
                            डेटा उपलब्ध नहीं
                        </p>
                    `;
                    
                    DOM.timeAnalysis.innerHTML = `
                        <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            <i class="fas fa-clock"></i><br>
                            डेटा उपलब्ध नहीं
                        </p>
                    `;
                    return;
                }
                
                // Update AI suggestion
                if (analysis.suggestions.length > 0) {
                    DOM.aiSuggestionText.textContent = analysis.suggestions.join('. ') + '.';
                }
                
                // Update department analysis
                let deptHtml = '<div style="display: flex; flex-direction: column; gap: 10px;">';
                for (const [dept, count] of Object.entries(analysis.departments)) {
                    const percentage = Math.round((count / analysis.totalRecords) * 100);
                    deptHtml += `
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>${dept}</span>
                                <span style="font-weight: 600;">${count} (${percentage}%)</span>
                            </div>
                            <div style="height: 8px; background: #eee; border-radius: 4px; overflow: hidden;">
                                <div style="height: 100%; width: ${percentage}%; background: var(--accent-color); border-radius: 4px;"></div>
                            </div>
                        </div>
                    `;
                }
                deptHtml += '</div>';
                DOM.departmentAnalysis.innerHTML = deptHtml;
                
                // Update time analysis
                const totalTime = analysis.timeSlots.morning + analysis.timeSlots.afternoon + analysis.timeSlots.evening;
                DOM.timeAnalysis.innerHTML = `
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>सुबह (12 बजे से पहले)</span>
                                <span style="font-weight: 600;">${analysis.timeSlots.morning}</span>
                            </div>
                            <div style="height: 8px; background: #eee; border-radius: 4px; overflow: hidden;">
                                <div style="height: 100%; width: ${totalTime > 0 ? (analysis.timeSlots.morning / totalTime * 100) : 0}%; background: #4CAF50; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>दोपहर (12-5 बजे)</span>
                                <span style="font-weight: 600;">${analysis.timeSlots.afternoon}</span>
                            </div>
                            <div style="height: 8px; background: #eee; border-radius: 4px; overflow: hidden;">
                                <div style="height: 100%; width: ${totalTime > 0 ? (analysis.timeSlots.afternoon / totalTime * 100) : 0}%; background: #2196F3; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>शाम (5 बजे के बाद)</span>
                                <span style="font-weight: 600;">${analysis.timeSlots.evening}</span>
                            </div>
                            <div style="height: 8px; background: #eee; border-radius: 4px; overflow: hidden;">
                                <div style="height: 100%; width: ${totalTime > 0 ? (analysis.timeSlots.evening / totalTime * 100) : 0}%; background: #FF9800; border-radius: 4px;"></div>
                            </div>
                        </div>
                    </div>
                `;
            }
        };
        
        // Toast Manager
        const Toast = {
            show(message, type = 'info', duration = 3000) {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                const icons = {
                    success: 'check-circle',
                    error: 'exclamation-circle',
                    warning: 'exclamation-triangle',
                    info: 'info-circle'
                };
                
                toast.innerHTML = `
                    <div class="toast-icon">
                        <i class="fas fa-${icons[type] || 'info-circle'}"></i>
                    </div>
                    <div class="toast-content">
                        <div class="toast-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                `;
                
                DOM.toastContainer.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 10);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, duration);
                
                return toast;
            },
            
            success(message, duration = 3000) {
                return this.show(message, 'success', duration);
            },
            
            error(message, duration = 3000) {
                return this.show(message, 'error', duration);
            },
            
            warning(message, duration = 3000) {
                return this.show(message, 'warning', duration);
            },
            
            info(message, duration = 3000) {
                return this.show(message, 'info', duration);
            }
        };
        
        // Storage Manager
        const Storage = {
            save(key, data) {
                try {
                    localStorage.setItem(`panchayat_ai_attendance_${key}`, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('Storage save error:', error);
                    return false;
                }
            },
            
            load(key) {
                try {
                    const data = localStorage.getItem(`panchayat_ai_attendance_${key}`);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('Storage load error:', error);
                    return null;
                }
            },
            
            remove(key) {
                try {
                    localStorage.removeItem(`panchayat_ai_attendance_${key}`);
                    return true;
                } catch (error) {
                    console.error('Storage remove error:', error);
                    return false;
                }
            }
        };
        
        // Voice Recognition System
        const VoiceSystem = {
            recognition: null,
            commands: {
                'अटेंडेंस दर्ज करो': () => switchTab('attendance'),
                'रिकॉर्ड दिखाओ': () => switchTab('records'),
                'मैप दिखाओ': () => switchTab('map'),
                'विश्लेषण दिखाओ': () => switchTab('analytics'),
                'कैमरा शुरू करो': () => CameraManager.start(),
                'फोटो लो': () => CameraManager.capture(),
                'स्थान रिफ्रेश करो': () => GPSManager.init(),
                'सबमिट करो': () => AttendanceManager.submit(),
                'मदद चाहिए': () => showHelp(),
                'सिस्टम स्टेटस': () => showSystemStatus()
            },
            
            init() {
                if (!CONFIG.VOICE_ENABLED) return;
                
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.lang = 'hi-IN';
                    this.recognition.interimResults = false;
                    
                    this.recognition.onstart = () => {
                        APP_STATE.isListening = true;
                        DOM.voiceCommandBtn.classList.add('listening');
                        Toast.info('सुन रहा हूँ... बोलें');
                    };
                    
                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.processCommand(transcript);
                    };
                    
                    this.recognition.onerror = (event) => {
                        console.error('Voice recognition error:', event.error);
                        Toast.error('वॉयस रिकग्निशन में त्रुटि');
                        this.stop();
                    };
                    
                    this.recognition.onend = () => {
                        this.stop();
                    };
                    
                    return true;
                } else {
                    console.warn('Voice recognition not supported');
                    return false;
                }
            },
            
            start() {
                if (this.recognition && !APP_STATE.isListening) {
                    this.recognition.start();
                }
            },
            
            stop() {
                if (APP_STATE.isListening) {
                    APP_STATE.isListening = false;
                    DOM.voiceCommandBtn.classList.remove('listening');
                }
            },
            
            processCommand(transcript) {
                console.log('Voice command:', transcript);
                
                let commandExecuted = false;
                
                for (const [command, action] of Object.entries(this.commands)) {
                    if (transcript.toLowerCase().includes(command.toLowerCase())) {
                        action();
                        Toast.success(`कमांड मिला: ${command}`);
                        commandExecuted = true;
                        break;
                    }
                }
                
                if (!commandExecuted) {
                    Toast.warning('कमांड नहीं पहचान सका, कृपया फिर से बोलें');
                }
                
                this.stop();
            }
        };
        
        // GPS Manager
        const GPSManager = {
            currentPosition: null,
            watchId: null,
            
            init() {
                return new Promise((resolve) => {
                    if (!navigator.geolocation) {
                        DOM.gpsStatus.innerHTML = '<i class="fas fa-times-circle"></i> समर्थित नहीं';
                        DOM.gpsStatus.style.color = 'var(--danger-color)';
                        resolve(null);
                        return;
                    }
                    
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            await this.handlePosition(position);
                            resolve(position);
                        },
                        (error) => {
                            this.handleError(error);
                            resolve(null);
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 0
                        }
                    );
                });
            },
            
            async handlePosition(position) {
                this.currentPosition = position;
                APP_STATE.currentLocation = {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                    accuracy: position.coords.accuracy,
                    timestamp: new Date().toISOString()
                };
                
                DOM.gpsStatus.innerHTML = '<i class="fas fa-check-circle"></i> सक्रिय';
                DOM.gpsStatus.style.color = 'var(--success-color)';
                DOM.coordinates.textContent = `${position.coords.latitude.toFixed(6)}, ${position.coords.longitude.toFixed(6)}`;
                DOM.accuracy.textContent = `${Math.round(position.coords.accuracy)} मीटर`;
                
                const address = await Utils.getAddressFromCoordinates(
                    position.coords.latitude,
                    position.coords.longitude
                );
                
                APP_STATE.currentAddress = address;
                DOM.addressText.textContent = address;
                
                if (window.L) {
                    this.initMap();
                }
                
                if (DOM.statusGps) {
                    DOM.statusGps.innerHTML = '<i class="fas fa-circle"></i> सक्रिय';
                    DOM.statusGps.style.color = 'var(--success-color)';
                }
                
                Toast.success('GPS स्थान प्राप्त हो गया');
            },
            
            handleError(error) {
                let message = 'अज्ञात त्रुटि';
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        message = 'अनुमति अस्वीकृत';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        message = 'स्थान उपलब्ध नहीं';
                        break;
                    case error.TIMEOUT:
                        message = 'समय समाप्त';
                        break;
                }
                
                DOM.gpsStatus.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
                DOM.gpsStatus.style.color = 'var(--warning-color)';
                DOM.coordinates.textContent = 'उपलब्ध नहीं';
                DOM.addressText.textContent = 'GPS चालू करें और रिफ्रेश करें';
                
                // Use demo location for testing
                APP_STATE.currentLocation = {
                    latitude: 25.1518,
                    longitude: 85.8565,
                    accuracy: 50,
                    timestamp: new Date().toISOString()
                };
                
                APP_STATE.currentAddress = 'पंचायती राज विभाग, शेखपुरा (डेमो लोकेशन)';
                DOM.addressText.textContent = APP_STATE.currentAddress;
                
                Toast.warning('डेमो लोकेशन उपयोग में');
            },
            
            initMap() {
                if (!this.currentPosition || !window.L) return;
                
                if (!APP_STATE.map) {
                    APP_STATE.map = L.map('map').setView(
                        [this.currentPosition.coords.latitude, this.currentPosition.coords.longitude], 
                        16
                    );
                    
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors',
                        maxZoom: 19
                    }).addTo(APP_STATE.map);
                } else {
                    APP_STATE.map.setView([this.currentPosition.coords.latitude, this.currentPosition.coords.longitude], 16);
                }
                
                // Clear existing markers
                APP_STATE.map.eachLayer((layer) => {
                    if (layer instanceof L.Marker) {
                        APP_STATE.map.removeLayer(layer);
                    }
                });
                
                const marker = L.marker([
                    this.currentPosition.coords.latitude, 
                    this.currentPosition.coords.longitude
                ]).addTo(APP_STATE.map);
                
                marker.bindPopup('<b>आपकी वर्तमान स्थिति</b><br>अटेंडेंस यहीं दर्ज की जाएगी').openPopup();
                
                L.circle([
                    this.currentPosition.coords.latitude, 
                    this.currentPosition.coords.longitude
                ], {
                    color: 'var(--accent-color)',
                    fillColor: 'var(--accent-color)',
                    fillOpacity: 0.1,
                    radius: this.currentPosition.coords.accuracy
                }).addTo(APP_STATE.map);
            },
            
            initLiveMap() {
                if (!window.L) return;
                
                if (!APP_STATE.liveMap) {
                    APP_STATE.liveMap = L.map('liveMap').setView([25.1518, 85.8565], 13);
                    
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors',
                        maxZoom: 19
                    }).addTo(APP_STATE.liveMap);
                }
                
                // Add sample markers for demo
                const locations = [
                    { lat: 25.1518, lng: 85.8565, name: 'मुख्य कार्यालय' },
                    { lat: 25.1618, lng: 85.8465, name: 'स्वास्थ्य केंद्र' },
                    { lat: 25.1418, lng: 85.8665, name: 'शिक्षा विभाग' }
                ];
                
                locations.forEach(loc => {
                    L.marker([loc.lat, loc.lng])
                        .addTo(APP_STATE.liveMap)
                        .bindPopup(`<b>${loc.name}</b>`);
                });
            },
            
            startLiveTracking() {
                if (!navigator.geolocation) {
                    Toast.error('जीपीएस समर्थित नहीं है');
                    return;
                }
                
                this.watchId = navigator.geolocation.watchPosition(
                    (position) => {
                        DOM.liveLat.textContent = position.coords.latitude.toFixed(6);
                        DOM.liveLon.textContent = position.coords.longitude.toFixed(6);
                        DOM.liveAccuracy.textContent = `${Math.round(position.coords.accuracy)} मीटर`;
                        DOM.liveSpeed.textContent = position.coords.speed ? `${(position.coords.speed * 3.6).toFixed(2)} किमी/घंटा` : '0 किमी/घंटा';
                        
                        if (APP_STATE.liveMap) {
                            APP_STATE.liveMap.setView([position.coords.latitude, position.coords.longitude], 15);
                        }
                    },
                    (error) => {
                        console.error('Live tracking error:', error);
                        Toast.error('लाइव ट्रैकिंग में त्रुटि');
                    },
                    {
                        enableHighAccuracy: true,
                        maximumAge: 0
                    }
                );
                
                Toast.success('लाइव ट्रैकिंग शुरू हो गई');
            },
            
            stopLiveTracking() {
                if (this.watchId) {
                    navigator.geolocation.clearWatch(this.watchId);
                    this.watchId = null;
                }
            },
            
            isLocationAccurate() {
                if (!this.currentPosition) return false;
                return this.currentPosition.coords.accuracy <= CONFIG.GPS_ACCURACY_THRESHOLD;
            }
        };
        
        // Camera Manager
        const CameraManager = {
            stream: null,
            isActive: false,
            currentCamera: 'user',
            
            async start(cameraType = 'user') {
                try {
                    await this.stop();
                    
                    const constraints = {
                        video: {
                            facingMode: cameraType,
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        },
                        audio: false
                    };
                    
                    this.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    
                    DOM.cameraPreview.srcObject = this.stream;
                    DOM.cameraPreview.style.display = 'block';
                    DOM.cameraPlaceholder.style.display = 'none';
                    
                    DOM.capturePhotoBtn.disabled = false;
                    
                    this.isActive = true;
                    this.currentCamera = cameraType;
                    
                    if (DOM.statusCamera) {
                        DOM.statusCamera.innerHTML = '<i class="fas fa-circle"></i> सक्रिय';
                        DOM.statusCamera.style.color = 'var(--success-color)';
                    }
                    
                    Toast.success('कैमरा शुरू हो गया');
                    return true;
                } catch (error) {
                    console.error('Camera start error:', error);
                    this.showCameraError(error);
                    return false;
                }
            },
            
            async stop() {
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.stream = null;
                }
                
                this.isActive = false;
                DOM.cameraPreview.style.display = 'none';
                DOM.cameraPlaceholder.style.display = 'flex';
                DOM.capturePhotoBtn.disabled = true;
                
                if (DOM.statusCamera) {
                    DOM.statusCamera.innerHTML = '<i class="fas fa-circle"></i> तैयार';
                    DOM.statusCamera.style.color = 'var(--text-secondary)';
                }
            },
            
            async switchCamera() {
                const newCamera = this.currentCamera === 'user' ? 'environment' : 'user';
                return this.start(newCamera);
            },
            
            capture() {
                if (!this.stream || !this.isActive) {
                    Toast.error('कैमरा सक्रिय नहीं है');
                    return null;
                }
                
                try {
                    const canvas = document.createElement('canvas');
                    const video = DOM.cameraPreview;
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.save();
                    
                    if (this.currentCamera === 'user') {
                        ctx.translate(canvas.width, 0);
                        ctx.scale(-1, 1);
                    }
                    
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    ctx.restore();
                    
                    // Add metadata
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(0, 0, canvas.width, 120);
                    
                    ctx.font = 'bold 16px Arial';
                    ctx.fillStyle = 'white';
                    ctx.textBaseline = 'top';
                    
                    const metadata = [
                        `कर्मचारी: ${DOM.employeeName.value || 'अज्ञात'}`,
                        `विभाग: ${DOM.department.value || 'अज्ञात'}`,
                        `समय: ${new Date().toLocaleString('hi-IN')}`,
                        `स्थान: ${APP_STATE.currentAddress || 'अज्ञात'}`,
                        `पंचायती राज विभाग, शेखपुरा`
                    ];
                    
                    let y = 20;
                    metadata.forEach(text => {
                        ctx.fillText(text, 20, y);
                        y += 25;
                    });
                    
                    const photoDataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    this.showPreview(photoDataUrl);
                    
                    APP_STATE.capturedPhoto = photoDataUrl;
                    
                    Toast.success('फोटो कैप्चर हो गई');
                    return photoDataUrl;
                } catch (error) {
                    console.error('Photo capture error:', error);
                    Toast.error('फोटो कैप्चर करने में विफल');
                    return null;
                }
            },
            
            showPreview(photoDataUrl) {
                DOM.capturedPhoto.src = photoDataUrl;
                DOM.photoPreview.style.display = 'block';
                
                DOM.metaName.textContent = DOM.employeeName.value || '-';
                DOM.metaDepartment.textContent = DOM.department.value || '-';
                DOM.metaDateTime.textContent = new Date().toLocaleString('hi-IN');
                DOM.metaLocation.textContent = APP_STATE.currentAddress || '-';
                
                const isAccurate = GPSManager.isLocationAccurate();
                const verificationBadge = DOM.metaVerification;
                
                if (isAccurate) {
                    verificationBadge.innerHTML = '<i class="fas fa-check-circle"></i> सत्यापित';
                    verificationBadge.className = 'verification-badge';
                } else {
                    verificationBadge.innerHTML = '<i class="fas fa-exclamation-triangle"></i> कम सटीकता';
                    verificationBadge.className = 'verification-badge error';
                }
                
                DOM.photoPreview.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            },
            
            showCameraError(error) {
                let message = 'कैमरा त्रुटि हुई';
                
                if (error.name === 'NotAllowedError') {
                    message = 'कैमरा एक्सेस अस्वीकृत। कृपया कैमरा एक्सेस की अनुमति दें।';
                } else if (error.name === 'NotFoundError') {
                    message = 'इस डिवाइस पर कोई कैमरा नहीं मिला।';
                }
                
                Toast.error(message);
                
                DOM.cameraPlaceholder.innerHTML = `
                    <i class="fas fa-video-slash" style="font-size: 4rem; margin-bottom: 20px;"></i>
                    <p>${message}</p>
                `;
            }
        };
        
        // Attendance Manager
        const AttendanceManager = {
            async submit() {
                try {
                    if (!this.validateForm()) {
                        return false;
                    }
                    
                    if (!APP_STATE.capturedPhoto) {
                        Toast.error('कृपया पहले फोटो कैप्चर करें');
                        return false;
                    }
                    
                    const record = {
                        id: Utils.generateId(),
                        employeeName: DOM.employeeName.value.trim(),
                        department: DOM.department.value.trim(),
                        designation: DOM.designation.value.trim(),
                        photo: APP_STATE.capturedPhoto,
                        location: APP_STATE.currentLocation,
                        address: APP_STATE.currentAddress,
                        timestamp: new Date().toISOString(),
                        date: new Date().toLocaleDateString('hi-IN'),
                        time: new Date().toLocaleTimeString('hi-IN'),
                        verified: GPSManager.isLocationAccurate()
                    };
                    
                    APP_STATE.attendanceRecords.unshift(record);
                    Storage.save('attendance_records', APP_STATE.attendanceRecords);
                    
                    this.resetForm();
                    this.updateStats();
                    this.displayRecords();
                    this.addRecentActivity(record);
                    
                    // Update AI Analysis
                    const analysis = Utils.generateAIAnalysis(APP_STATE.attendanceRecords);
                    Utils.updateAIDisplay(analysis);
                    
                    Toast.success(`${record.employeeName} की अटेंडेंस दर्ज हो गई`);
                    
                    // Show AI feedback
                    if (CONFIG.AI_ENABLED) {
                        setTimeout(() => {
                            Toast.info('AI ने नई अटेंडेंस का विश्लेषण किया', 2000);
                        }, 1000);
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Attendance submission error:', error);
                    Toast.error('अटेंडेंस सबमिट करने में विफल');
                    return false;
                }
            },
            
            validateForm() {
                const name = DOM.employeeName.value.trim();
                const department = DOM.department.value.trim();
                
                let isValid = true;
                let errors = [];
                
                if (!name) {
                    errors.push('कर्मचारी का नाम आवश्यक है');
                    DOM.employeeName.classList.add('error');
                    isValid = false;
                } else {
                    DOM.employeeName.classList.remove('error');
                }
                
                if (!department) {
                    errors.push('विभाग आवश्यक है');
                    DOM.department.classList.add('error');
                    isValid = false;
                } else {
                    DOM.department.classList.remove('error');
                }
                
                if (errors.length > 0) {
                    Toast.error(errors.join('<br>'));
                }
                
                return isValid;
            },
            
            resetForm() {
                DOM.photoPreview.style.display = 'none';
                APP_STATE.capturedPhoto = null;
                CameraManager.stop();
            },
            
            loadRecords(filters = {}) {
                let records = APP_STATE.attendanceRecords;
                
                if (filters.dateFrom) {
                    const fromDate = new Date(filters.dateFrom);
                    records = records.filter(record => new Date(record.timestamp) >= fromDate);
                }
                
                if (filters.dateTo) {
                    const toDate = new Date(filters.dateTo);
                    records = records.filter(record => new Date(record.timestamp) <= toDate);
                }
                
                if (filters.department) {
                    records = records.filter(record => record.department === filters.department);
                }
                
                this.displayRecords(records);
                return records;
            },
            
            displayRecords(records = APP_STATE.attendanceRecords) {
                const container = DOM.recordsContainer;
                
                if (records.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-clipboard"></i>
                            <h3>कोई रिकॉर्ड नहीं मिला</h3>
                            <p>अटेंडेंस दर्ज करके रिकॉर्ड्स यहाँ देखें</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                records.forEach(record => {
                    const initials = record.employeeName.split(' ').map(n => n[0]).join('').toUpperCase();
                    
                    html += `
                        <div class="record-card" data-id="${record.id}">
                            <div class="record-header">
                                <div class="record-employee">
                                    <div class="record-avatar">
                                        ${initials.substring(0, 2)}
                                    </div>
                                    <div class="record-info">
                                        <h4>${record.employeeName}</h4>
                                        <div class="record-department">
                                            <i class="fas fa-building"></i>
                                            ${record.department}
                                        </div>
                                    </div>
                                </div>
                                <div class="record-time">
                                    ${record.time}
                                </div>
                            </div>
                            <div class="record-details">
                                <div class="record-detail">
                                    <span class="record-label">पदनाम</span>
                                    <span class="record-value">${record.designation || 'N/A'}</span>
                                </div>
                                <div class="record-detail">
                                    <span class="record-label">पता</span>
                                    <span class="record-value">${record.address || 'अज्ञात'}</span>
                                </div>
                                <div class="record-detail">
                                    <span class="record-label">सटीकता</span>
                                    <span class="record-value">${record.location ? Math.round(record.location.accuracy) + ' मी' : 'N/A'}</span>
                                </div>
                                <div class="record-detail">
                                    <span class="record-label">स्थिति</span>
                                    <span class="record-value">
                                        <span class="verification-badge ${record.verified ? '' : 'error'}">
                                            <i class="fas fa-${record.verified ? 'check-circle' : 'exclamation-triangle'}"></i>
                                            ${record.verified ? 'सत्यापित' : 'कम सटीकता'}
                                        </span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            },
            
            exportCSV() {
                const data = APP_STATE.attendanceRecords;
                
                if (data.length === 0) {
                    Toast.error('एक्सपोर्ट करने के लिए कोई रिकॉर्ड नहीं');
                    return;
                }
                
                const headers = ['तारीख', 'समय', 'कर्मचारी का नाम', 'विभाग', 'पदनाम', 'पता', 'सत्यापित'];
                const csvRows = [
                    headers.join(','),
                    ...data.map(record => [
                        `"${record.date}"`,
                        `"${record.time}"`,
                        `"${record.employeeName}"`,
                        `"${record.department}"`,
                        `"${record.designation || ''}"`,
                        `"${record.address || ''}"`,
                        record.verified ? 'हाँ' : 'नहीं'
                    ].join(','))
                ];
                
                const csvContent = csvRows.join('\n');
                const filename = `panchayat_ai_attendance_${new Date().toISOString().split('T')[0]}.csv`;
                
                if (Utils.saveToDevice(filename, csvContent, 'text/csv;charset=utf-8;')) {
                    Toast.success('CSV फाइल डाउनलोड हो गई');
                } else {
                    Toast.error('डाउनलोड विफल');
                }
            },
            
            savePhotoToPhone() {
                if (!APP_STATE.capturedPhoto) {
                    Toast.error('कोई फोटो उपलब्ध नहीं');
                    return;
                }
                
                const employeeName = DOM.employeeName.value.trim() || 'अटेंडेंस';
                const filename = `अटेंडेंस_${employeeName}_${Date.now()}.jpg`;
                
                const byteString = atob(APP_STATE.capturedPhoto.split(',')[1]);
                const mimeString = APP_STATE.capturedPhoto.split(',')[0].split(':')[1].split(';')[0];
                const ab = new ArrayBuffer(byteString.length);
                const ia = new Uint8Array(ab);
                
                for (let i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }
                
                const blob = new Blob([ab], { type: mimeString });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                
                document.body.appendChild(link);
                link.click();
                
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
                
                Toast.success('फोटो फोन में सेव हो गई');
            },
            
            saveAllDataToPhone() {
                if (APP_STATE.attendanceRecords.length === 0) {
                    Toast.error('सेव करने के लिए कोई डाटा नहीं');
                    return;
                }
                
                const data = {
                    app: CONFIG.APP_NAME,
                    version: CONFIG.VERSION,
                    exportDate: new Date().toISOString(),
                    records: APP_STATE.attendanceRecords
                };
                
                const filename = `पंचायत_AI_अटेंडेंस_डाटा_${new Date().toISOString().split('T')[0]}.json`;
                const content = JSON.stringify(data, null, 2);
                
                if (Utils.saveToDevice(filename, content, 'application/json')) {
                    Toast.success('सभी डाटा फोन में सेव हो गया');
                } else {
                    Toast.error('डाटा सेव करने में विफल');
                }
            },
            
            updateStats() {
                const today = new Date().toLocaleDateString('hi-IN');
                const todayRecords = APP_STATE.attendanceRecords.filter(r => r.date === today);
                const thisMonth = new Date().getMonth();
                const thisMonthRecords = APP_STATE.attendanceRecords.filter(r => new Date(r.timestamp).getMonth() === thisMonth);
                
                DOM.statToday.textContent = todayRecords.length;
                DOM.statTotal.textContent = APP_STATE.attendanceRecords.length;
                DOM.statMonth.textContent = thisMonthRecords.length;
                
                const validRecords = APP_STATE.attendanceRecords.filter(r => r.location && r.location.accuracy);
                if (validRecords.length > 0) {
                    const avgAccuracy = Math.round(validRecords.reduce((sum, r) => sum + r.location.accuracy, 0) / validRecords.length);
                    DOM.statAccuracy.textContent = `${avgAccuracy}मी`;
                } else {
                    DOM.statAccuracy.textContent = '0मी';
                }
                
                // Update storage status
                const storageData = JSON.stringify(APP_STATE.attendanceRecords);
                const storageUsage = Math.round((storageData.length / (5 * 1024 * 1024)) * 100);
                if (DOM.statusStorage) {
                    DOM.statusStorage.innerHTML = `<i class="fas fa-circle"></i> ${Math.min(storageUsage, 100)}%`;
                    DOM.statusStorage.style.color = storageUsage > 80 ? 'var(--warning-color)' : 'var(--success-color)';
                }
            },
            
            addRecentActivity(record) {
                const activity = {
                    id: Utils.generateId(),
                    message: `${record.employeeName} की अटेंडेंस दर्ज हुई`,
                    time: record.time,
                    icon: 'fa-user-check'
                };
                
                const container = DOM.recentActivity;
                
                if (container.querySelector('.empty-state')) {
                    container.innerHTML = '';
                }
                
                const activityHtml = `
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; 
                          border-bottom: 1px solid var(--border-color);">
                        <div style="width: 30px; height: 30px; border-radius: 50%; background: var(--success-color); 
                             display: flex; align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 0.9rem;">${activity.message}</div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary);">${activity.time}</div>
                        </div>
                    </div>
                `;
                
                // Add new activity at the top
                container.innerHTML = activityHtml + container.innerHTML;
                
                const activities = container.querySelectorAll('div');
                if (activities.length > 5) {
                    for (let i = 5; i < activities.length; i++) {
                        activities[i].remove();
                    }
                }
            }
        };
        
        // Event Handlers
        const EventHandlers = {
            init() {
                // Tab switching
                DOM.tabBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tab = btn.dataset.tab;
                        this.switchTab(tab);
                    });
                });
                
                // Help button
                DOM.helpBtn.addEventListener('click', () => {
                    this.showHelp();
                });
                
                // AI Assistant button
                DOM.aiAssistantBtn.addEventListener('click', () => {
                    this.toggleAIAssistant();
                });
                
                // Download data button
                DOM.downloadDataBtn.addEventListener('click', () => {
                    AttendanceManager.saveAllDataToPhone();
                });
                
                // Refresh location
                DOM.refreshLocationBtn.addEventListener('click', () => {
                    GPSManager.init();
                });
                
                // Camera controls
                DOM.startCameraBtn.addEventListener('click', () => {
                    if (CameraManager.isActive) {
                        CameraManager.stop();
                        DOM.startCameraBtn.innerHTML = '<i class="fas fa-video"></i> कैमरा शुरू करें';
                    } else {
                        CameraManager.start();
                        DOM.startCameraBtn.innerHTML = '<i class="fas fa-stop"></i> कैमरा बंद करें';
                    }
                });
                
                DOM.capturePhotoBtn.addEventListener('click', () => {
                    CameraManager.capture();
                });
                
                DOM.switchCameraBtn.addEventListener('click', () => {
                    CameraManager.switchCamera();
                });
                
                // Photo preview controls
                DOM.retakePhotoBtn.addEventListener('click', () => {
                    DOM.photoPreview.style.display = 'none';
                    APP_STATE.capturedPhoto = null;
                });
                
                DOM.saveToPhoneBtn.addEventListener('click', () => {
                    AttendanceManager.savePhotoToPhone();
                });
                
                DOM.submitAttendanceBtn.addEventListener('click', () => {
                    AttendanceManager.submit();
                });
                
                // Records filter
                DOM.applyFilterBtn.addEventListener('click', () => {
                    const filters = {
                        dateFrom: DOM.dateFrom.value,
                        dateTo: DOM.dateTo.value,
                        department: DOM.filterDepartment.value
                    };
                    
                    AttendanceManager.loadRecords(filters);
                });
                
                DOM.clearFilterBtn.addEventListener('click', () => {
                    DOM.dateFrom.value = '';
                    DOM.dateTo.value = '';
                    DOM.filterDepartment.value = '';
                    
                    AttendanceManager.displayRecords();
                });
                
                // Export buttons
                DOM.exportCsvBtn.addEventListener('click', () => {
                    AttendanceManager.exportCSV();
                });
                
                DOM.exportToPhoneBtn.addEventListener('click', () => {
                    AttendanceManager.saveAllDataToPhone();
                });
                
                DOM.downloadAllBtn.addEventListener('click', () => {
                    AttendanceManager.saveAllDataToPhone();
                });
                
                // Quick action buttons
                DOM.quickMarkBtn.addEventListener('click', () => {
                    this.switchTab('attendance');
                });
                
                DOM.viewTodayBtn.addEventListener('click', () => {
                    this.switchTab('records');
                    const today = new Date().toISOString().split('T')[0];
                    DOM.dateFrom.value = today;
                    DOM.dateTo.value = today;
                    AttendanceManager.loadRecords({dateFrom: today, dateTo: today});
                });
                
                DOM.exportDataBtn.addEventListener('click', () => {
                    AttendanceManager.exportCSV();
                });
                
                DOM.savePhoneBtn.addEventListener('click', () => {
                    AttendanceManager.saveAllDataToPhone();
                });
                
                // Employee name autocomplete
                DOM.employeeName.addEventListener('input', () => {
                    this.handleNameAutocomplete();
                });
                
                // Voice command button
                DOM.voiceCommandBtn.addEventListener('click', () => {
                    if (VoiceSystem.recognition) {
                        if (APP_STATE.isListening) {
                            VoiceSystem.stop();
                        } else {
                            VoiceSystem.start();
                        }
                    } else {
                        Toast.warning('वॉयस सपोर्ट उपलब्ध नहीं');
                    }
                });
                
                // Start live tracking
                DOM.startLiveTrackingBtn.addEventListener('click', () => {
                    GPSManager.startLiveTracking();
                    DOM.startLiveTrackingBtn.innerHTML = '<i class="fas fa-stop-circle"></i> लाइव ट्रैकिंग बंद करें';
                    DOM.startLiveTrackingBtn.onclick = () => {
                        GPSManager.stopLiveTracking();
                        DOM.startLiveTrackingBtn.innerHTML = '<i class="fas fa-play-circle"></i> लाइव ट्रैकिंग शुरू करें';
                        DOM.startLiveTrackingBtn.onclick = () => {
                            GPSManager.startLiveTracking();
                            DOM.startLiveTrackingBtn.innerHTML = '<i class="fas fa-stop-circle"></i> लाइव ट्रैकिंग बंद करें';
                        };
                    };
                });
                
                // AI Assistant modal
                DOM.startListeningBtn.addEventListener('click', () => {
                    if (VoiceSystem.recognition) {
                        VoiceSystem.start();
                        DOM.aiResponse.innerHTML = `
                            <div style="padding: 10px; background: white; border-radius: 8px;">
                                <strong>AI:</strong> सुन रहा हूँ... बोलें
                            </div>
                        `;
                    }
                });
                
                DOM.closeAssistantBtn.addEventListener('click', () => {
                    this.toggleAIAssistant();
                });
                
                // Set today's date in filters
                const today = new Date().toISOString().split('T')[0];
                DOM.dateFrom.value = today;
                DOM.dateTo.value = today;
                
                // Initialize offline detection
                this.initOfflineDetection();
            },
            
            switchTab(tabName) {
                DOM.tabBtns.forEach(btn => {
                    if (btn.dataset.tab === tabName) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                DOM.tabPanes.forEach(pane => {
                    if (pane.id === `${tabName}Tab`) {
                        pane.classList.add('active');
                    } else {
                        pane.classList.remove('active');
                    }
                });
                
                APP_STATE.activeTab = tabName;
                
                // If switching to map tab, initialize live map
                if (tabName === 'map') {
                    GPSManager.initLiveMap();
                }
                
                // If switching to analytics tab, update AI analysis
                if (tabName === 'analytics') {
                    const analysis = Utils.generateAIAnalysis(APP_STATE.attendanceRecords);
                    Utils.updateAIDisplay(analysis);
                }
            },
            
            showHelp() {
                alert(`पंचायती राज विभाग, शेखपुरा - AI स्मार्ट अटेंडेंस सिस्टम\n\nमुख्य फीचर्स:\n1. कर्मचारी का विवरण भरें\n2. GPS स्थान का इंतजार करें\n3. कैमरा शुरू करें और फोटो लें\n4. समीक्षा करें और अटेंडेंस सबमिट करें\n\nनए AI फीचर्स:\n- वॉयस कमांड सपोर्ट\n- स्वतः डेटा विश्लेषण\n- रियल-टाइम इनसाइट्स\n- ऑफलाइन काम करने की क्षमता\n\nवॉयस कमांड:\n"अटेंडेंस दर्ज करो", "कैमरा शुरू करो", "फोटो लो", "मदद चाहिए"\n\nविकसित: अमन कुमार`);
            },
            
            toggleAIAssistant() {
                APP_STATE.aiAssistantActive = !APP_STATE.aiAssistantActive;
                DOM.aiAssistantModal.style.display = APP_STATE.aiAssistantActive ? 'flex' : 'none';
                
                if (APP_STATE.aiAssistantActive) {
                    this.showAIGreeting();
                }
            },
            
            showAIGreeting() {
                const greetings = [
                    "नमस्ते! मैं आपका AI असिस्टेंट हूं। आप कैसे मदद कर सकता हूं?",
                    "स्वागत है! मैं आपकी अटेंडेंस मैनेजमेंट में मदद कर सकता हूं।",
                    "हैलो! बोलकर कमांड दें जैसे 'अटेंडेंस दिखाओ' या 'रिपोर्ट बनाओ'।"
                ];
                
                DOM.aiResponse.innerHTML = `
                    <div style="padding: 10px; background: white; border-radius: 8px; margin-bottom: 10px;">
                        <strong>AI:</strong> ${greetings[Math.floor(Math.random() * greetings.length)]}
                    </div>
                `;
            },
            
            handleNameAutocomplete() {
                const query = DOM.employeeName.value.toLowerCase();
                if (query.length < 2) {
                    DOM.nameAutocomplete.innerHTML = '';
                    return;
                }
                
                const employees = [
                    { name: 'राजेश कुमार', department: 'पंचायत विकास' },
                    { name: 'प्रिया शर्मा', department: 'स्वास्थ्य सेवाएं' },
                    { name: 'अमित पटेल', department: 'शिक्षा' },
                    { name: 'स्नेहा सिंह', department: 'प्रशासन' },
                    { name: 'विक्रम यादव', department: 'फील्ड ऑपरेशन' },
                    { name: 'अंजलि गुप्ता', department: 'पंचायत विकास' },
                    { name: 'राहुल वर्मा', department: 'स्वास्थ्य सेवाएं' },
                    { name: 'मीना चौधरी', department: 'शिक्षा' }
                ];
                
                const matches = employees.filter(emp => 
                    emp.name.toLowerCase().includes(query)
                );
                
                if (matches.length === 0) {
                    DOM.nameAutocomplete.innerHTML = '<div class="autocomplete-item">कोई मिलान नहीं मिला</div>';
                    return;
                }
                
                let html = '';
                matches.forEach(emp => {
                    const initials = emp.name.split(' ').map(n => n[0]).join('').toUpperCase();
                    
                    html += `
                        <div class="autocomplete-item" onclick="EventHandlers.selectEmployee('${emp.name}', '${emp.department}')">
                            <div class="employee-avatar">
                                ${initials.substring(0, 2)}
                            </div>
                            <div class="employee-info">
                                <div class="employee-name">${emp.name}</div>
                                <div class="employee-department">${emp.department}</div>
                            </div>
                        </div>
                    `;
                });
                
                DOM.nameAutocomplete.innerHTML = html;
            },
            
            selectEmployee(name, department) {
                DOM.employeeName.value = name;
                DOM.department.value = department;
                DOM.nameAutocomplete.innerHTML = '';
            },
            
            initOfflineDetection() {
                window.addEventListener('online', () => {
                    APP_STATE.isOnline = true;
                    DOM.offlineBanner.style.display = 'none';
                    Toast.info('ऑनलाइन हो गया, डेटा सिंक हो रहा है...', 2000);
                });
                
                window.addEventListener('offline', () => {
                    APP_STATE.isOnline = false;
                    DOM.offlineBanner.style.display = 'block';
                    Toast.warning('ऑफलाइन मोड में स्विच किया गया', 2000);
                });
                
                // Initial check
                if (!navigator.onLine) {
                    APP_STATE.isOnline = false;
                    DOM.offlineBanner.style.display = 'block';
                }
            }
        };
        
        // Helper functions
        function switchTab(tabName) {
            EventHandlers.switchTab(tabName);
        }
        
        function showHelp() {
            EventHandlers.showHelp();
        }
        
        function showSystemStatus() {
            const status = `
                GPS: ${GPSManager.currentPosition ? 'सक्रिय' : 'निष्क्रिय'}<br>
                कैमरा: ${CameraManager.isActive ? 'सक्रिय' : 'तैयार'}<br>
                AI: ${CONFIG.AI_ENABLED ? 'सक्रिय' : 'निष्क्रिय'}<br>
                वॉयस: ${CONFIG.VOICE_ENABLED ? 'सक्रिय' : 'निष्क्रिय'}<br>
                ऑफलाइन: ${!APP_STATE.isOnline ? 'हाँ' : 'नहीं'}
            `;
            Toast.info(status, 5000);
        }
        
        // Application Initialization
        class AIAttendanceSystem {
            constructor() {
                this.init();
            }
            
            async init() {
                try {
                    DOM.loadingText.innerHTML = `
                        <span class="ai-badge" style="margin-bottom: 20px;">
                            <i class="fas fa-brain"></i> AI सिस्टम शुरू हो रहा है...
                        </span>
                        <br>
                        पंचायती राज विभाग, शेखपुरा<br>AI अटेंडेंस सिस्टम शुरू हो रहा है...
                    `;
                    
                    initDOMReferences();
                    
                    // Load data
                    const savedRecords = Storage.load('attendance_records');
                    if (savedRecords) {
                        APP_STATE.attendanceRecords = savedRecords;
                    }
                    
                    // Initialize GPS
                    await GPSManager.init();
                    
                    // Initialize Voice System
                    if (CONFIG.VOICE_ENABLED) {
                        VoiceSystem.init();
                    }
                    
                    // Setup event handlers
                    EventHandlers.init();
                    
                    // Update stats and display
                    AttendanceManager.updateStats();
                    AttendanceManager.displayRecords();
                    
                    // Update AI Analysis
                    if (CONFIG.AI_ENABLED) {
                        const analysis = Utils.generateAIAnalysis(APP_STATE.attendanceRecords);
                        Utils.updateAIDisplay(analysis);
                        
                        // Update AI status
                        if (DOM.statusAI) {
                            DOM.statusAI.innerHTML = '<i class="fas fa-circle"></i> सक्रिय';
                            DOM.statusAI.style.color = '#667eea';
                        }
                    }
                    
                    setTimeout(() => {
                        DOM.loadingOverlay.classList.add('hidden');
                        APP_STATE.isLoading = false;
                        Toast.success('पंचायती राज विभाग AI स्मार्ट अटेंडेंस सिस्टम तैयार!');
                    }, 1000);
                    
                } catch (error) {
                    console.error('Initialization error:', error);
                    DOM.loadingText.textContent = 'त्रुटि: पेज रिफ्रेश करें';
                    Toast.error('सिस्टम शुरू करने में विफल');
                }
            }
        }
        
        // Start the application
        document.addEventListener('DOMContentLoaded', () => {
            new AIAttendanceSystem();
        });
    </script>
</body>
</html>